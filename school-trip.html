<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¿®å­¦æ—…è¡Œ è‡ªä¸»ç ”ä¿®ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');

  :root {
    --primary-color: #4A90E2;
    --accent-color: #FF6B6B;
    --bg-color: #F5F7FA;
    --card-bg: #FFFFFF;
    --text-color: #333333;
    --border-radius: 12px;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 20px;
    line-height: 1.6;
  }

  .container {
    max-width: 600px;
    margin: 0 auto;
  }

  h1 {
    text-align: center;
    color: var(--primary-color);
    margin-bottom: 20px;
    font-size: 1.8rem;
  }

  /* ç­æƒ…å ±å…¥åŠ›ã‚¨ãƒªã‚¢ */
  .group-info-card {
    background: var(--card-bg);
    padding: 15px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }

  .group-info-item {
    flex: 1;
    min-width: 200px;
  }

  .group-info-item label {
    display: block;
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 4px;
  }

  .group-info-item input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
  }

  button.print-btn {
    display: block;
    width: 200px;
    margin: 0 auto 30px auto;
    background-color: #2ECC71;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  button.print-btn:hover {
    background-color: #27AE60;
  }
  
  /* å°åˆ·ç”¨ã‚³ãƒ³ãƒ†ãƒŠï¼ˆç”»é¢ä¸Šã¯éè¡¨ç¤ºï¼‰ */
  #print-container {
    display: none;
  }

  @media print {
    /* é€šå¸¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å…¨ã¦éè¡¨ç¤º */
    .container, .input-card, h2 {
      display: none !important;
    }
    
    body {
      background: white;
      margin: 0;
      padding: 0;
      font-size: 10pt;
      color: #000;
      -webkit-print-color-adjust: exact;
    }

    /* å°åˆ·ç”¨ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º */
    #print-container {
      display: block;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
    }

    .print-title {
      text-align: center;
      font-size: 16pt;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #333;
    }

    .print-group-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-size: 11pt;
      font-weight: bold;
    }

    .print-group-info div {
      border-bottom: 1px solid #999;
      padding-bottom: 5px;
      min-width: 200px;
    }

    /* å°åˆ·ç”¨ãƒ†ãƒ¼ãƒ–ãƒ« */
    .print-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 9pt;
    }

    .print-table th, .print-table td {
      border: 1px solid #333;
      padding: 6px 8px;
      vertical-align: top;
    }

    .print-table th {
      background-color: #f0f0f0 !important;
      text-align: center;
      font-weight: bold;
      white-space: nowrap;
    }

    .print-table td.time-col {
      text-align: center;
      white-space: nowrap;
      font-weight: bold;
      width: 15%; 
    }

    .print-table td.place-col {
      font-weight: bold;
      width: 35%;
    }

    .print-table td.memo-col {
      white-space: pre-wrap;
      width: 50%;
    }
  }

  .input-card {
    background: var(--card-bg);
    padding: 20px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 30px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 0.9rem;
    color: #666;
  }

  input, textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    box-sizing: border-box;
    font-family: inherit;
    transition: border-color 0.3s;
  }

  input:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  textarea {
    resize: vertical;
    min-height: 80px;
  }

  button.add-btn {
    width: 100%;
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  button.add-btn:hover {
    background-color: #357ABD;
  }

  h2 {
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 10px;
    margin-bottom: 20px;
  }

  /* Timeline Styles */
  .timeline {
    position: relative;
    padding-left: 20px;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 7px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #ddd;
    z-index: 0;
  }

  .plan-item {
    position: relative;
    background: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    transition: transform 0.2s;
    z-index: 1;
  }

  .plan-item:hover {
    transform: translateY(-2px);
  }

  .plan-item::before {
    content: '';
    position: absolute;
    left: -24px;
    top: 20px;
    width: 12px;
    height: 12px;
    background: var(--primary-color);
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 0 0 2px var(--primary-color);
  }

  /* æ‰€è¦æ™‚é–“è¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .travel-time {
    font-size: 0.85rem;
    color: #666;
    background-color: #f0f4f8;
    padding: 4px 10px;
    border-radius: 20px;
    margin-bottom: 10px;
    display: inline-block;
    border: 1px solid #dbe2e8;
  }

  .plan-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }

  /* ç·¨é›†å¯èƒ½ãªæ™‚åˆ»å…¥åŠ›ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .time-edit-input {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 1.1rem;
    font-weight: bold;
    color: var(--primary-color);
    background: transparent;
    border: 1px solid transparent;
    border-radius: 4px;
    padding: 0 4px;
    cursor: pointer;
    width: auto;
    /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®inputã‚¹ã‚¿ã‚¤ãƒ«ã‚’å°‘ã—ãƒªã‚»ãƒƒãƒˆ */
    display: inline-block;
  }
  
  .time-edit-input:hover, .time-edit-input:focus {
    background: #fff;
    border-color: #ddd;
    outline: none;
    color: var(--text-color);
  }

  .plan-place {
    font-weight: bold;
    font-size: 1.1rem;
  }

  .plan-links a {
    display: inline-block;
    color: var(--primary-color);
    text-decoration: none;
    font-size: 0.9rem;
    margin-right: 10px;
  }

  .plan-links a:hover {
    text-decoration: underline;
  }

  .plan-memo {
    width: 100%;
    box-sizing: border-box;
    background: #f9f9f9;
    padding: 8px;
    border: 1px solid #eee;
    border-radius: 6px;
    font-size: 0.9rem;
    color: #555;
    margin-top: 10px;
    resize: vertical;
    font-family: inherit;
    min-height: 60px;
  }

  .plan-memo:focus {
    background: #fff;
    border-color: var(--primary-color);
    outline: none;
  }

  .delete-btn {
    background: transparent;
    border: 1px solid #ddd;
    color: #888;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    margin-left: 10px;
  }

  .delete-btn:hover {
    background: #fee;
    color: var(--accent-color);
    border-color: var(--accent-color);
  }

  .empty-state {
    text-align: center;
    color: #888;
    padding: 40px 0;
  }
</style>
</head>
<body>

<!-- å°åˆ·ç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
<div id="print-container"></div>

<div class="container">
  <h1>âœˆï¸ ä¿®å­¦æ—…è¡Œ æ—…ç¨‹è¡¨</h1>
  
  <div class="group-info-card">
    <div class="group-info-item">
      <label for="group-name">ç­å</label>
      <input type="text" id="group-name" placeholder="ä¾‹ï¼š1ç­ã€ã„ã¡ã”ç­" onchange="saveGroupInfo()">
    </div>
    <div class="group-info-item">
      <label for="members">ãƒ¡ãƒ³ãƒãƒ¼</label>
      <input type="text" id="members" placeholder="ä¾‹ï¼šä½è—¤ã€éˆ´æœ¨ã€é«˜æ©‹ã€ç”°ä¸­" onchange="saveGroupInfo()">
    </div>
  </div>

  <button class="print-btn" onclick="prepareAndPrint()">ğŸ“„ PDFä¿å­˜ / å°åˆ·</button>

  <div class="input-card">
    <div class="form-group">
      <label for="time">æ™‚åˆ»</label>
      <input type="time" id="time">
    </div>
    <div class="form-group">
      <label for="place">å ´æ‰€ãƒ»ç›®çš„åœ°</label>
      <input type="text" id="place" placeholder="ä¾‹ï¼šæœ­å¹Œå¸‚æ™‚è¨ˆå°ã€ãƒ†ãƒ¬ãƒ“å¡”">
    </div>
    <div class="form-group">
      <label for="url">Googleãƒãƒƒãƒ— URL</label>
      <input type="url" id="url" placeholder="https://maps.app.goo.gl/...">
    </div>
    <div class="form-group">
      <label for="memo">ãƒ¡ãƒ¢</label>
      <textarea id="memo" placeholder="é›†åˆå ´æ‰€ã®è©³ç´°ã€é£Ÿã¹ãŸã„ã‚‚ã®ãªã©"></textarea>
    </div>
    <button class="add-btn" onclick="addPlan()">ï¼‹ ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
  </div>

  <h2>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>
  <div id="plans" class="timeline"></div>
</div>

<script>
  // DOMè¦ç´ ã®å–å¾—
  const timeInput = document.getElementById('time');
  const placeInput = document.getElementById('place');
  const urlInput = document.getElementById('url');
  const memoInput = document.getElementById('memo');
  const plansContainer = document.getElementById('plans');
  const groupNameInput = document.getElementById('group-name');
  const membersInput = document.getElementById('members');

  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
  let plans = JSON.parse(localStorage.getItem("plans")) || [];
  let groupInfo = JSON.parse(localStorage.getItem("groupInfo")) || { name: "", members: "" };

  // ç­æƒ…å ±ã®åˆæœŸè¡¨ç¤º
  groupNameInput.value = groupInfo.name;
  membersInput.value = groupInfo.members;

  function saveGroupInfo() {
    groupInfo.name = groupNameInput.value;
    groupInfo.members = membersInput.value;
    localStorage.setItem("groupInfo", JSON.stringify(groupInfo));
  }

  function addPlan() {
    // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
    if (!timeInput.value || !placeInput.value) {
      alert("æ™‚åˆ»ã¨å ´æ‰€ã¯å¿…é ˆå…¥åŠ›ã§ã™ï¼");
      return;
    }

    const plan = {
      time: timeInput.value,
      place: placeInput.value,
      url: urlInput.value,
      memo: memoInput.value
    };

    plans.push(plan);
    // æ™‚åˆ»é †ã«ã‚½ãƒ¼ãƒˆ
    sortPlans();
    
    saveAndRender();
    
    // å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
    timeInput.value = "";
    placeInput.value = "";
    urlInput.value = "";
    memoInput.value = "";
  }

  function removePlan(index) {
    if(confirm('ã“ã®äºˆå®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      plans.splice(index, 1);
      saveAndRender();
    }
  }
  
  // æ™‚åˆ»æ›´æ–°å‡¦ç†
  function updateTime(index, newTime) {
    if (!newTime) return;
    plans[index].time = newTime;
    sortPlans(); // æ™‚åˆ»å¤‰æ›´å¾Œã«å†ã‚½ãƒ¼ãƒˆ
    saveAndRender();
  }

  // ãƒ¡ãƒ¢æ›´æ–°å‡¦ç†
  function updateMemo(index, val) {
    plans[index].memo = val;
    // å†æç”»ã¯ã›ãšãƒ‡ãƒ¼ã‚¿ä¿å­˜ã®ã¿ï¼ˆå…¥åŠ›ä¸­ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¤–ã‚Œã‚’é˜²ããŸã‚ï¼‰
    localStorage.setItem("plans", JSON.stringify(plans));
  }

  function sortPlans() {
    plans.sort((a, b) => a.time.localeCompare(b.time));
  }

  function saveAndRender() {
    localStorage.setItem("plans", JSON.stringify(plans));
    render();
  }

  // æ™‚é–“å·®åˆ†ã‚’è¨ˆç®—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  function getDiffTime(startTime, endTime) {
    const [startH, startM] = startTime.split(':').map(Number);
    const [endH, endM] = endTime.split(':').map(Number);
    
    const startTotal = startH * 60 + startM;
    const endTotal = endH * 60 + endM;
    
    let diff = endTotal - startTotal;
    
    // æ—¥ã¾ãŸãã®è¨ˆç®—ã¯ç°¡æ˜“çš„ã«ä»Šå›ã¯è€ƒæ…®ã›ãšã€å˜ç´”ãªå·®åˆ†ï¼ˆãƒã‚¤ãƒŠã‚¹ãªã‚‰0ã«ã™ã‚‹ç­‰ã‚‚å¯ã ãŒã€ä¸¦ã³æ›¿ãˆæ¸ˆã¿å‰æï¼‰
    if (diff < 0) return null; // åŸºæœ¬ã‚ã‚Šãˆãªã„ãŒå¿µã®ãŸã‚

    const h = Math.floor(diff / 60);
    const m = diff % 60;
    
    if (h > 0) {
      return `${h}æ™‚é–“${m}åˆ†`;
    }
    return `${m}åˆ†`;
  }

  // å°åˆ·ç”¨HTMLç”Ÿæˆé–¢æ•°
  function prepareAndPrint() {
    const printContainer = document.getElementById('print-container');
    
    // ç¾åœ¨ã®å…¥åŠ›å†…å®¹ã‚’ç¢ºå®Ÿã«ä¿å­˜
    saveGroupInfo();
    
    let html = `
      <div class="print-title">ä¿®å­¦æ—…è¡Œ æ—…ç¨‹è¡¨</div>
      <div class="print-group-info">
        <div>ç­åï¼š ${groupInfo.name}</div>
        <div>ãƒ¡ãƒ³ãƒãƒ¼ï¼š ${groupInfo.members}</div>
      </div>
      <table class="print-table">
        <thead>
          <tr>
            <th style="width:15%">æ™‚åˆ»</th>
            <th style="width:35%">å ´æ‰€</th>
            <th style="width:50%">ç›®çš„ãƒ»æ‰‹æ®µãƒ»è²»ç”¨</th>
          </tr>
        </thead>
        <tbody>
    `;
    
    plans.forEach((p, i) => {
      // æ”¹è¡Œã‚’ <br> ã«å¤‰æ›
      const memoContent = p.memo ? p.memo.replace(/\n/g, '<br>') : '';
      
      html += `
        <tr>
          <td class="time-col">${p.time}</td>
          <td class="place-col">${p.place}</td>
          <td class="memo-col">${memoContent}</td>
        </tr>
      `;
    });
    
    html += `
        </tbody>
      </table>
    `;
    
    printContainer.innerHTML = html;
    window.print();
  }

  function render() {
    plansContainer.innerHTML = "";
    
    if (plans.length === 0) {
      plansContainer.innerHTML = '<div class="empty-state">äºˆå®šãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>';
      return;
    }
    

    plans.forEach((p, i) => {
      // URLãŒã‚ã‚‹å ´åˆã®ã¿ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
      const mapLink = p.url 
        ? `<a href="${p.url}" target="_blank">ğŸ“ ãƒãƒƒãƒ—ã‚’é–‹ã</a>` 
        : '';
      
      // å‰ã®å ´æ‰€ã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆæ¤œç´¢ãƒªãƒ³ã‚¯
      let routeLink = '';
      if (i > 0) {
        const prevPlace = encodeURIComponent(plans[i-1].place);
        const currPlace = encodeURIComponent(p.place);
        // Google Maps Directions APIå½¢å¼
        const directionsUrl = `https://www.google.com/maps/dir/?api=1&origin=${prevPlace}&destination=${currPlace}&travelmode=transit`;
        routeLink = `<a href="${directionsUrl}" target="_blank" style="margin-left: 10px; color: #E67E22;">ğŸš¶ ãƒ«ãƒ¼ãƒˆæ¤œç´¢</a>`;
      }
      
      // ãƒ¡ãƒ¢ã‚¨ãƒªã‚¢ã‚’ç·¨é›†å¯èƒ½ãªtextareaã«å¤‰æ›´
      const memoBlock = `<textarea class="plan-memo" onchange="updateMemo(${i}, this.value)" placeholder="ç›®çš„ï¼ˆä½•ã®ãŸã‚ã«ï¼‰ã€æ‰‹æ®µï¼ˆä½•ã‚’ã™ã‚‹ã‹ï¼‰ã€è²»ç”¨ï¼ˆãŠé‡‘ã¯ã„ãã‚‰ã‹ã‹ã‚‹ã‹ï¼‰ã‚’è¨˜å…¥">${p.memo || ''}</textarea>`;

      // å‰ã®äºˆå®šã¨ã®æ™‚é–“å·®ã‚’è¡¨ç¤º
      let timeDiffHtml = '';
      if (i > 0) {
        const diffText = getDiffTime(plans[i-1].time, p.time);
        if (diffText) {
          timeDiffHtml = `<div class="travel-time">â†“ å‰ã®å ´æ‰€ã‹ã‚‰ ${diffText}</div>`;
        }
      }

      plansContainer.innerHTML += `
        <div class="plan-item">
          ${timeDiffHtml}
          <div class="plan-header">
            <div style="display: flex; align-items: center;">
              <!-- æ™‚åˆ»ã‚’ç·¨é›†å¯èƒ½ãªinputã«å¤‰æ›´ -->
              <input type="time" class="time-edit-input" value="${p.time}" onchange="updateTime(${i}, this.value)" title="æ™‚åˆ»ã‚’å¤‰æ›´ã™ã‚‹ã¨è‡ªå‹•ã§ä¸¦ã³æ›¿ã‚ã‚Šã¾ã™">
              <span style="margin: 0 8px; color:#ddd;">|</span>
              <span class="plan-place">${p.place}</span>
            </div>
            <button class="delete-btn" onclick="removePlan(${i})">å‰Šé™¤</button>
          </div>
          <div class="plan-links">
            ${mapLink}
            ${routeLink}
          </div>
          ${memoBlock}
        </div>`;
    });
  }

  // åˆå›è¡¨ç¤º
  render();
</script>

</body>
</html>
