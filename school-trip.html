<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—…ã®ã—ãŠã‚Š</title>
<style>
  /* System Fonts & Modern Reset */
  :root {
    --text-main: #1d1d1f;       /* ã»ã¼é»’ */
    --text-sub: #86868b;        /* ã‚°ãƒ¬ãƒ¼ */
    --bg-body: #f5f5f7;         /* Appleç³»ãƒ©ã‚¤ãƒˆã‚°ãƒ¬ãƒ¼èƒŒæ™¯ */
    --bg-card: #ffffff;         /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ */
    --accent-color: #ff6b6b;    /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼ˆã‚³ãƒ¼ãƒ©ãƒ«ãƒ”ãƒ³ã‚¯ï¼‰ */
    --accent-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
    --button-bg: #1d1d1f;       /* ãƒœã‚¿ãƒ³èƒŒæ™¯ï¼ˆé»’ï¼‰ */
    --button-text: #ffffff;
    --border-radius: 20px;
    --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.04);
    --shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.08);
    --transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Yu Gothic", YuGothic, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    margin: 0;
    padding: 60px 20px;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    letter-spacing: 0.03em;
  }

  .container {
    max-width: 740px;
    margin: 0 auto;
  }

  /* ã‚¿ã‚¤ãƒˆãƒ«å‘¨ã‚Š */
  h1 {
    text-align: center;
    color: var(--text-main);
    margin-bottom: 50px;
    font-size: 2.4rem;
    font-weight: 800;
    letter-spacing: 0.05em;
    position: relative;
    display: inline-block;
    left: 50%;
    transform: translateX(-50%);
  }
  
  h1::after {
    content: '';
    display: block;
    width: 60px;
    height: 4px;
    background: var(--accent-color);
    margin: 15px auto 0;
    border-radius: 2px;
  }

  /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
  .card {
    background: var(--bg-card);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-soft);
    padding: 40px;
    margin-bottom: 30px;
    transition: var(--transition);
    border: 1px solid rgba(0,0,0,0.02);
  }

  .card:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-2px);
  }

  /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
  .group-info-card {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .group-info-item {
    flex: 1;
    min-width: 200px;
  }

  label {
    display: block;
    font-size: 0.85rem;
    color: var(--text-sub);
    margin-bottom: 8px;
    font-weight: 600;
  }

  .input-wrapper {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  input, textarea, select {
    width: 100%;
    padding: 16px;
    border: 2px solid transparent;
    border-radius: 12px;
    background-color: #f0f0f2;
    color: var(--text-main);
    font-size: 1rem;
    font-family: inherit;
    box-sizing: border-box;
    transition: var(--transition);
    appearance: none; /* OSæ¨™æº–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ */
  }

  .time-select-group {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .time-select-group select {
    width: 80px;
    text-align: center;
  }

  input:focus, textarea:focus, select:focus {
    outline: none;
    background-color: #fff;
    border-color: var(--text-main); /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã¯é»’æ ã§å¼•ãç· ã‚ã‚‹ */
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  textarea {
    resize: vertical;
    min-height: 100px;
  }

  /* ãƒœã‚¿ãƒ³ */
  button {
    font-family: inherit;
    border: none;
    cursor: pointer;
    font-weight: 700;
    transition: var(--transition);
  }

  button.print-btn {
    display: block;
    margin: 0 auto 50px;
    background: transparent;
    color: var(--text-sub);
    font-size: 0.9rem;
    padding: 10px 20px;
    border-radius: 30px;
    border: 1px solid #e0e0e0;
  }

  button.print-btn:hover {
    color: var(--text-main);
    border-color: var(--text-main);
    background: #fff;
  }

  button.add-btn {
    width: 100%;
    background-color: var(--button-bg);
    color: var(--button-text);
    padding: 18px;
    border-radius: 14px;
    font-size: 1.1rem;
    margin-top: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  button.add-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    background-color: #000;
  }

  .form-group {
    margin-bottom: 24px;
  }

  /* è¦‹å‡ºã—2 */
  h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-main);
    margin: 60px 0 30px;
    padding-left: 10px;
    border-left: 4px solid var(--text-main);
  }

  /* ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ */
  .timeline {
    position: relative;
    padding-left: 40px;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 12px;
    top: 15px;
    bottom: 15px;
    width: 1px;
    background: #d1d1d6; /* éå¸¸ã«ç´°ã„ç·š */
    z-index: 0;
  }

  .plan-item {
    position: relative;
    background: var(--bg-card);
    border-radius: var(--border-radius);
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: var(--shadow-soft);
    transition: var(--transition);
    z-index: 1;
  }

  .plan-item:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-3px);
  }

  /* ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®ãƒ‰ãƒƒãƒˆ */
  .plan-item::before {
    content: '';
    position: absolute;
    left: -32px;
    top: 35px;
    width: 9px;
    height: 9px;
    background: var(--bg-body);
    border: 2px solid var(--text-main);
    border-radius: 50%;
    z-index: 2;
  }

  /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆæ™‚é–“ãƒ»å ´æ‰€ãƒ»å‰Šé™¤ï¼‰ */
  .plan-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
  }

  .time-place-wrapper {
    display: flex;
    align-items: baseline;
    flex-wrap: wrap;
    gap: 15px;
    flex: 1;
  }

  /* ç·¨é›†ç”¨ã®æ™‚é–“ãƒ»åˆ†ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .time-edit-container {
    display: flex;
    align-items: center;
    gap: 2px;
  }
  
  .time-edit-select {
    font-family: "Helvetica Neue", Arial, sans-serif;
    font-size: 2rem; /* æ™‚é–“ã‚’å¤§ããå¼·èª¿ */
    font-weight: 200;
    color: var(--text-main);
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    line-height: 1;
    appearance: none;
    -webkit-appearance: none;
    text-align: center;
  }
  
  .time-edit-select:hover {
    color: var(--text-sub);
  }

  .time-separator {
    font-size: 2rem;
    font-weight: 200;
    line-height: 1;
    margin: 0 2px 5px 2px; /* å°‘ã—ä½ç½®èª¿æ•´ */
  }

  /* å ´æ‰€å…¥åŠ› */
  .plan-place-input {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--text-main);
    background: transparent;
    border: none;
    border-bottom: 1px solid transparent;
    border-radius: 0;
    padding: 0 0 2px 0;
    width: auto;
    flex-grow: 1;
    cursor: pointer;
    transition: var(--transition);
    margin-left: 10px;
  }

  .plan-place-input:focus, .plan-place-input:hover {
    background: transparent;
    border-bottom-color: var(--text-sub);
    box-shadow: none;
  }

  .delete-btn {
    background: #fff0f0;
    color: var(--accent-color);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.8rem;
    transition: var(--transition);
  }

  .delete-btn:hover {
    background: var(--accent-color);
    color: white;
  }

  /* ãƒªãƒ³ã‚¯é¡ */
  .plan-links {
    margin-bottom: 20px;
    display: flex;
    gap: 12px;
  }

  .plan-links a {
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-main);
    background: #f0f0f2;
    padding: 8px 16px;
    border-radius: 20px;
    transition: var(--transition);
  }

  .plan-links a:hover {
    background: #e0e0e2;
    transform: translateY(-1px);
  }

  /* è©³ç´°æƒ…å ±ï¼ˆç§»å‹•æ™‚é–“ãƒ»äº¤é€šè²»ï¼‰ */
  .plan-details-line {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
    padding: 15px;
    background: #fafafa;
    border-radius: 12px;
  }

  .plan-detail {
    display: flex;
    align-items: center;
    flex: 1;
    min-width: 140px;
  }

  .plan-detail label {
    margin: 0 10px 0 0;
    font-size: 0.8rem;
    color: var(--text-sub);
    white-space: nowrap;
  }

  .plan-detail-input {
    flex: 1;
    background: transparent;
    border: none;
    padding: 0;
    font-size: 0.95rem;
    color: var(--text-main);
    text-align: right;
    font-weight: 600;
    border-radius: 0;
  }
  
  .plan-detail-input:focus {
    background: transparent;
    box-shadow: none;
    border-bottom: 1px solid var(--text-main);
  }
  
  /* è¿½åŠ : ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .plan-detail-input::placeholder {
    color: #d1d1d6;
    font-weight: 400;
  }

  /* ãƒ¡ãƒ¢ */
  .plan-memo {
    width: 100%;
    background: transparent; /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ã«é¦´æŸ“ã¾ã›ã‚‹ */
    border: none;
    /* border-top: 1px solid #f0f0f0; */
    padding: 10px 0 0 0;
    border-radius: 0;
    font-size: 0.95rem;
    color: var(--text-sub);
    line-height: 1.8;
    min-height: 60px;
  }

  .plan-memo:focus {
    background: transparent;
    box-shadow: none;
    color: var(--text-main);
  }

  .plan-memo::placeholder {
    color: #d1d1d6;
  }

  /* ç§»å‹•æ™‚é–“ã®è¡¨ç¤ºï¼ˆç¸¦è»¸ï¼‰ */
  .travel-time-indicator {
    font-size: 0.75rem;
    color: var(--text-sub);
    background: #fff;
    padding: 4px 10px;
    border: 1px solid #e5e5e5;
    border-radius: 12px;
    margin-bottom: 20px;
    display: inline-block;
    font-weight: 500;
  }

  .empty-state {
    text-align: center;
    color: var(--text-sub);
    padding: 100px 0;
    font-size: 1.1rem;
    font-weight: 500;
  }

  /* å°åˆ·è¨­å®š */
  #print-container { display: none; }

  @media print {
    .container, .input-card, h2, button { display: none !important; }
    body { background: #fff; color: #000; padding: 0; font-family: serif; }
    
    #print-container {
      display: block;
      width: 100%;
      padding: 30px;
      box-sizing: border-box;
    }
    
    .print-title {
      display: none; /* ã‚¿ã‚¤ãƒˆãƒ«ã‚’éè¡¨ç¤ºã« */
    }

    .print-group-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      font-size: 12pt;
    }

    .print-table {
      width: 100%;
      border-collapse: collapse;
    }

    .print-table th {
      border-bottom: 2px solid #000;
      padding: 10px;
      text-align: left;
      font-weight: bold;
    }

    .print-table td {
      border-bottom: 1px solid #ccc;
      padding: 15px 10px;
      vertical-align: top;
    }
    
    .print-table td.time-col { width: 15%; font-weight: bold; }
    .print-table td.place-col { width: 30%; font-weight: bold; font-size: 1.1em; }
    .print-table td.memo-col { width: 55%; font-size: 0.9em; color: #444; }
  }
</style>
</head>
<body>

<!-- å°åˆ·ç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
<div id="print-container"></div>

<div class="container">
  <h1>æ—…ã®ã—ãŠã‚Š</h1>
  <button class="print-btn" onclick="prepareAndPrint()">ğŸ–¨ï¸ å°åˆ· / PDFä¿å­˜</button>
  
  <div class="group-info-card card">
    <div class="group-info-item">
      <label for="group-name">ç­åãƒ»ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="group-name" placeholder="ä¾‹ï¼š1ç­ã€ã€‡ã€‡æ—…è¡Œ" onchange="saveGroupInfo()">
    </div>
    <div class="group-info-item">
      <label for="members">ãƒ¡ãƒ³ãƒãƒ¼</label>
      <input type="text" id="members" placeholder="ä¾‹ï¼šä½è—¤ã€éˆ´æœ¨ã€é«˜æ©‹ã€ç”°ä¸­" onchange="saveGroupInfo()">
    </div>
  </div>

  <div class="input-card card">
    <div class="form-group">
      <label for="time">æ™‚åˆ»</label>
      <div class="time-select-group">
        <select id="hour"></select>
        <span>:</span>
        <select id="minute"></select>
      </div>
    </div>
    <div class="form-group">
      <label for="place">ç›®çš„åœ°ãƒ»å ´æ‰€</label>
      <input type="text" id="place" placeholder="ä¾‹ï¼šæœ­å¹Œå¸‚æ™‚è¨ˆå°">
    </div>
    <div class="form-group">
      <label for="url">Googleãƒãƒƒãƒ— URL</label>
      <input type="url" id="url" placeholder="https://maps.app.goo.gl/...">
    </div>
    <div class="form-group">
      <label for="memo">ãƒ¡ãƒ¢</label>
      <textarea id="memo" placeholder="é›†åˆå ´æ‰€ã®è©³ç´°ã€é£Ÿã¹ãŸã„ã‚‚ã®ã€ã‚„ã‚ŠãŸã„ã“ã¨ãªã©"></textarea>
    </div>
    <button class="add-btn" onclick="addPlan()">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
  </div>

  <h2>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>
  <div id="plans" class="timeline"></div>
</div>

<script>
  // DOMè¦ç´ 
  const hourInput = document.getElementById('hour');
  const minuteInput = document.getElementById('minute');
  const placeInput = document.getElementById('place');
  const urlInput = document.getElementById('url');
  const memoInput = document.getElementById('memo');
  const plansContainer = document.getElementById('plans');
  const groupNameInput = document.getElementById('group-name');
  const membersInput = document.getElementById('members');

  // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
  let plans = JSON.parse(localStorage.getItem("plans")) || [];
  let groupInfo = JSON.parse(localStorage.getItem("groupInfo")) || { name: "", members: "" };

  // åˆæœŸè¡¨ç¤º
  groupNameInput.value = groupInfo.name;
  membersInput.value = groupInfo.members;

  // æ™‚åˆ»é¸æŠè‚¢ã®ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼ (æ™‚é–“)
  function generateHourOptions(selectedHour) {
    let options = "";
    // selectedHourãŒã‚‚ã—ä¸€æ¡ã§ãã¦ã‚‚0åŸ‹ã‚ã—ã¦æ¯”è¼ƒãƒ»è¡¨ç¤ºã™ã‚‹
    const normalizedSelected = selectedHour ? selectedHour.toString().padStart(2, '0') : "";
    
    for (let h = 0; h < 24; h++) {
      const hh = h.toString().padStart(2, '0');
      const selected = hh === normalizedSelected ? " selected" : "";
      options += `<option value="${hh}"${selected}>${hh}</option>`;
    }
    return options;
  }

  // æ™‚åˆ»é¸æŠè‚¢ã®ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼ (åˆ†)
  function generateMinuteOptions(selectedMinute) {
    let options = "";
    let found = false;
    // selectedMinuteã‚‚ã‚¼ãƒ­åŸ‹ã‚ã—ã¦æ­£è¦åŒ–
    const normalizedSelected = selectedMinute ? selectedMinute.toString().padStart(2, '0') : "";

    for (let m = 0; m < 60; m += 5) { // 5åˆ†åˆ»ã¿
      const mm = m.toString().padStart(2, '0');
      const selected = mm === normalizedSelected;
      if (selected) found = true;
      options += `<option value="${mm}"${selected ? " selected" : ""}>${mm}</option>`;
    }
    // 5åˆ†åˆ»ã¿ä»¥å¤–ãŒå«ã¾ã‚Œã¦ã„ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆæ‰‹å‹•å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãªã©ã¸ã®å¯¾å¿œï¼‰
    if (!found && normalizedSelected) {
        options = `<option value="${normalizedSelected}" selected>${normalizedSelected}</option>` + options;
    }
    return options;
  }
  
  // ãƒ¡ã‚¤ãƒ³ã®æ™‚åˆ»å…¥åŠ›ã«é¸æŠè‚¢ã‚’ã‚»ãƒƒãƒˆ
  // ç¾åœ¨ã®æ™‚åˆ»ã‚’å–å¾—ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã™ã‚‹
  const now = new Date();
  // ç¾åœ¨æ™‚åˆ»ã®åˆæœŸè¨­å®šæ™‚ã«ã‚‚ã‚¼ãƒ­åŸ‹ã‚ã‚’ç¢ºå®Ÿã«è¡Œã†
  hourInput.innerHTML = generateHourOptions(now.getHours().toString().padStart(2, '0'));
  minuteInput.innerHTML = generateMinuteOptions((Math.floor(now.getMinutes() / 5) * 5).toString().padStart(2, '0'));

  function saveGroupInfo() {
    groupInfo.name = groupNameInput.value;
    groupInfo.members = membersInput.value;
    localStorage.setItem("groupInfo", JSON.stringify(groupInfo));
  }

  function addPlan() {
    if (!hourInput.value || !minuteInput.value || !placeInput.value) {
      alert("æ™‚åˆ»ã¨å ´æ‰€ã¯å¿…é ˆã§ã™");
      return;
    }

    const plan = {
      time: `${hourInput.value}:${minuteInput.value}`,
      place: placeInput.value,
      url: urlInput.value,
      memo: memoInput.value,
      travelTime: "", 
      transportCost: "" 
    };

    plans.push(plan);
    sortPlans();
    saveAndRender();
    
    // ã‚¯ãƒªã‚¢
    placeInput.value = "";
    urlInput.value = "";
    memoInput.value = "";
  }

  function removePlan(index) {
    if(confirm('ã“ã®äºˆå®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      plans.splice(index, 1);
      saveAndRender();
    }
  }
  
  // æ™‚é–“ã ã‘æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateHour(index, newHour) {
    const currentMinute = plans[index].time.split(':')[1];
    const newTime = `${newHour}:${currentMinute}`;
    updateTime(index, newTime);
  }

  // åˆ†ã ã‘æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateMinute(index, newMinute) {
    const currentHour = plans[index].time.split(':')[0];
    const newTime = `${currentHour}:${newMinute}`;
    updateTime(index, newTime);
  }
  
  function updateTime(index, newTime) {
    if (!newTime) return;
    plans[index].time = newTime;
    sortPlans();
    saveAndRender();
  }

  function updatePlace(index, val) {
    // ç©ºæ–‡å­—ã«ãªã£ã¦ã‚‚ç·¨é›†å¯èƒ½ã«ã™ã‚‹ãŸã‚ãƒã‚§ãƒƒã‚¯ã‚’ç·©ã‚ã‚‹ã€ã¾ãŸã¯å‰Šé™¤ã¯ã•ã›ãªã„
    if (val === null) return;
    plans[index].place = val;
    saveAndRender(); // å ´æ‰€å¤‰æ›´ã¯å³åº§ã«åæ˜ 
  }

  function updateMemo(index, val) {
    plans[index].memo = val;
    localStorage.setItem("plans", JSON.stringify(plans));
  }

  function updateTravelTime(index, val) {
    plans[index].travelTime = val;
    localStorage.setItem("plans", JSON.stringify(plans));
  }

  function updateTransportCost(index, val) {
    plans[index].transportCost = val;
    localStorage.setItem("plans", JSON.stringify(plans));
  }

  function sortPlans() {
    plans.sort((a, b) => a.time.localeCompare(b.time));
  }

  function saveAndRender() {
    localStorage.setItem("plans", JSON.stringify(plans));
    render();
  }

  function getDiffTime(startTime, endTime) {
    const [startH, startM] = startTime.split(':').map(Number);
    const [endH, endM] = endTime.split(':').map(Number);
    let diff = (endH * 60 + endM) - (startH * 60 + startM);
    
    // æ—¥ä»˜ã¾ãŸãã¯å˜ç´”åŒ–ã®ãŸã‚è€ƒæ…®ã—ãªã„ï¼ˆãƒã‚¤ãƒŠã‚¹ã®å ´åˆã¯è¡¨ç¤ºã—ãªã„ï¼‰
    if (diff <= 0) return null; 
    
    const h = Math.floor(diff / 60);
    const m = diff % 60;
    
    if (h > 0 && m > 0) return `${h}æ™‚é–“${m}åˆ†`;
    if (h > 0) return `${h}æ™‚é–“`;
    return `${m}åˆ†`;
  }

  function prepareAndPrint() {
    const printContainer = document.getElementById('print-container');
    saveGroupInfo();
    
    let html = `
      <div class="print-group-info">
        <div><strong>ç­åï¼š</strong> ${groupInfo.name}</div>
        <div><strong>ãƒ¡ãƒ³ãƒãƒ¼ï¼š</strong> ${groupInfo.members}</div>
      </div>
      <table class="print-table">
        <thead>
          <tr>
            <th style="width:15%">æ™‚åˆ»</th>
            <th style="width:30%">å ´æ‰€</th>
            <th style="width:55%">è©³ç´°</th>
          </tr>
        </thead>
        <tbody>
    `;
    
    plans.forEach((p, i) => {
      let metaInfo = [];
      if (p.travelTime) metaInfo.push(`â³ ${p.travelTime}`);
      if (p.transportCost) metaInfo.push(`ğŸ’° ${p.transportCost}`);
      
      const metaInfoStr = metaInfo.length > 0 ? `<div style="margin-bottom:5px; font-size:0.85em; color:#666;">${metaInfo.join('ã€€')}</div>` : '';
      const memoContent = p.memo ? p.memo.replace(/\n/g, '<br>') : '';
      
      html += `
        <tr>
          <td class="time-col">${p.time}</td>
          <td class="place-col">${p.place}</td>
          <td class="memo-col">${metaInfoStr}${memoContent}</td>
        </tr>
      `;
    });
    
    html += `</tbody></table>`;
    printContainer.innerHTML = html;
    window.print();
  }

  function render() {
    plansContainer.innerHTML = "";
    
    if (plans.length === 0) {
      plansContainer.innerHTML = '<div class="empty-state">äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>';
      return;
    }

    plans.forEach((p, i) => {
      const mapLink = p.url 
        ? `<a href="${p.url}" target="_blank">å ´æ‰€ â†—</a>` 
        : '';
      
      let routeLink = '';
      if (i > 0) {
        // ç›´å‰ã®å ´æ‰€ã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆæ¤œç´¢ãƒªãƒ³ã‚¯ç”Ÿæˆ
        const prevPlace = encodeURIComponent(plans[i-1].place);
        const currPlace = encodeURIComponent(p.place);
        // Google Mapsã®ãƒ«ãƒ¼ãƒˆæ¤œç´¢URL (å…¬å…±äº¤é€šæ©Ÿé–¢)
        const directionsUrl = `https://www.google.com/maps/dir/?api=1&origin=${prevPlace}&destination=${currPlace}&travelmode=transit`;
        routeLink = `<a href="${directionsUrl}" target="_blank">è¡Œãæ–¹ â†—</a>`;
      }
      
      const travelTimeBlock = `
        <div class="plan-detail">
          <label>â³ ç§»å‹•æ™‚é–“</label>
          <input type="text" class="plan-detail-input" value="${p.travelTime || ''}" placeholder="ä¾‹: 30åˆ†" onchange="updateTravelTime(${i}, this.value)">
        </div>`;
      
      const transportCostBlock = `
        <div class="plan-detail">
          <label>ğŸ’° äº¤é€šè²»</label>
          <input type="text" class="plan-detail-input" value="${p.transportCost || ''}" placeholder="ä¾‹: 500å††" onchange="updateTransportCost(${i}, this.value)">
        </div>`;

      const memoBlock = `<textarea class="plan-memo" onchange="updateMemo(${i}, this.value)" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›...">${p.memo || ''}</textarea>`;

      let timeDiffHtml = '';
      if (i > 0) {
        const diffText = getDiffTime(plans[i-1].time, p.time);
        if (diffText) {
          timeDiffHtml = `<div class="travel-time-indicator">â†“ ç´„ ${diffText}</div>`;
        }
      }

      // æ™‚é–“ã‚’åˆ†å‰²ã—ã¦ã‚¼ãƒ­åŸ‹ã‚ã‚’ä¿è¨¼
      let [pHour, pMinute] = p.time.split(':');
      pHour = pHour ? pHour.padStart(2, '0') : "00";
      pMinute = pMinute ? pMinute.padStart(2, '0') : "00";

      plansContainer.innerHTML += `
        <div class="plan-item">
          ${timeDiffHtml}
          <div class="plan-header">
            <div class="time-place-wrapper">
              <div class="time-edit-container">
                <select class="time-edit-select" onchange="updateHour(${i}, this.value)">
                  ${generateHourOptions(pHour)}
                </select>
                <span class="time-separator">:</span>
                <select class="time-edit-select" onchange="updateMinute(${i}, this.value)">
                  ${generateMinuteOptions(pMinute)}
                </select>
              </div>
              <input type="text" class="plan-place-input" value="${p.place}" onchange="updatePlace(${i}, this.value)" title="å ´æ‰€ã‚’ç·¨é›†">
            </div>
            <button class="delete-btn" onclick="removePlan(${i})">å‰Šé™¤</button>
          </div>
          
          <div class="plan-links">
            ${mapLink}
            ${routeLink}
          </div>

          <div class="plan-details-line">
            ${travelTimeBlock}
            ${transportCostBlock}
          </div>
          
          ${memoBlock}
        </div>`;
    });
  }

  // åˆå›è¡¨ç¤º
  render();
</script>

</body>
</html>
