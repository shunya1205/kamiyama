<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R80è‡ªå‹•ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚·ã‚¹ãƒ†ãƒ </title>
    <!-- Tailwind CSSã®èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Noto Sans JP", sans-serif;
            background-color: #F5F5F7; /* Appleç³»ãƒ©ã‚¤ãƒˆã‚°ãƒ¬ãƒ¼ */
            color: #1D1D1F; /* Appleç³»ãƒ–ãƒ©ãƒƒã‚¯ */
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ */
        .main-card {
            background-color: #FFFFFF;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ */
        #r80Input {
            background-color: #F5F5F7;
            border: 2px solid transparent;
            border-radius: 16px;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        #r80Input:focus {
            background-color: #FFFFFF;
            border-color: #0071E3; /* Apple Blue */
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
            outline: none;
        }

        /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .tab-btn {
            position: relative;
            font-weight: 500;
            color: #86868B;
            transition: color 0.3s;
        }
        .tab-btn:hover {
            color: #1D1D1F;
        }
        .tab-active {
            color: #1D1D1F;
            font-weight: 700;
        }
        .tab-active::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background-color: #1D1D1F;
            border-radius: 2px;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn-primary {
            background-color: #0071E3;
            color: white;
            border-radius: 9999px;
            transition: all 0.2s;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #0077ED;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
        }
        .btn-primary:disabled {
            background-color: #E5E5EA;
            color: #86868B;
            cursor: not-allowed;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .status-card {
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 1rem;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .bg-success { background-color: #F2FCF5; color: #1F7A43; }
        .bg-warning { background-color: #FFF9E6; color: #9A6B00; }
        .bg-error { background-color: #FEF2F2; color: #CC3300; }
        .bg-info { background-color: #F0F8FF; color: #0066CC; }

        /* æ¥ç¶šè©ãƒãƒƒã‚¸ */
        .connector-badge {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 99px;
            font-weight: 700;
            margin-right: 8px;
            display: inline-block;
            min-width: 60px;
            text-align: center;
        }
        
        /* å±¥æ­´ãƒªã‚¹ãƒˆ */
        .history-item {
            background: #FFFFFF;
            border-bottom: 1px solid #E5E5EA;
            transition: background 0.2s;
        }
        .history-item:last-child { border-bottom: none; }
        .history-item:hover { background: #F5F5F7; }

        /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex justify-center items-start">

    <div class="max-w-4xl w-full main-card p-8 sm:p-12 my-8 fade-in">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
        <header class="mb-10 text-center">
            <h1 class="text-4xl sm:text-5xl font-bold mb-3 tracking-tight text-gray-900">
                R80 ç¢ºèªãƒ„ãƒ¼ãƒ«
            </h1>
            <p class="text-gray-500 font-medium text-lg">
                è«–ç†çš„æ€è€ƒåŠ›ã‚’å‘ä¸Šã—ã‚ˆã†
            </p>
        </header>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="flex justify-center gap-12 mb-12 border-b border-gray-200 pb-2">
            <button onclick="switchTab('practice')" id="btn-practice" class="tab-btn tab-active text-lg pb-2 focus:outline-none">
                ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
            </button>
            <button onclick="switchTab('connectors')" id="btn-connectors" class="tab-btn text-lg pb-2 focus:outline-none">
                æ¥ç¶šè©ãƒªã‚¹ãƒˆ
            </button>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼šãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° (ãƒ¡ã‚¤ãƒ³) -->
        <div id="tab-practice" class="space-y-10 fade-in">
            
            <!-- ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="grid md:grid-cols-2 gap-8">
                <!-- ãƒ«ãƒ¼ãƒ« -->
                <div class="bg-gray-50 rounded-3xl p-8">
                    <h3 class="font-bold text-xl mb-4 text-gray-900 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                        R80ã®ãƒ«ãƒ¼ãƒ«
                    </h3>
                    <ul class="space-y-3 text-gray-600 font-medium">
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â—</span>80å­—å‰å¾Œã§æ›¸ã
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â—</span>å¿…ãšã€Œ2æ–‡ã€ã§æ›¸ãï¼ˆå¥ç‚¹ã¯2ã¤ï¼‰
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â—</span>2æ–‡ç›®ã®æœ€åˆã«ã€Œæ¥ç¶šè©ã€ã‚’ç½®ã
                        </li>
                    </ul>
                </div>

                <!-- æ¥ç¶šè©ä¾‹ -->
                <div class="bg-gray-50 rounded-3xl p-8">
                    <h3 class="font-bold text-xl mb-4 text-gray-900 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                        </svg>
                        ä½¿ç”¨ã™ã‚‹æ¥ç¶šè©ã®ä¾‹
                    </h3>
                    <ul class="space-y-3 text-sm">
                        <li class="flex items-center">
                            <span class="connector-badge bg-blue-100 text-blue-700">é †æ¥</span>
                            <span class="text-gray-600">ã—ãŸãŒã£ã¦ã€ã‚†ãˆã«ã€ã ã‹ã‚‰</span>
                        </li>
                        <li class="flex items-center">
                            <span class="connector-badge bg-red-100 text-red-700">é€†æ¥</span>
                            <span class="text-gray-600">ã—ã‹ã—ã€ã ãŒã€ã¨ã“ã‚ãŒ</span>
                        </li>
                        <li class="flex items-center">
                            <span class="connector-badge bg-green-100 text-green-700">ä¸¦åˆ—</span>
                            <span class="text-gray-600">ã¾ãŸã€ãªã‚‰ã³ã«ã€ã‹ã¤</span>
                        </li>
                        <li class="flex items-center">
                            <span class="connector-badge bg-purple-100 text-purple-700">å¯¾æ¯”</span>
                            <span class="text-gray-600">ä¸€æ–¹</span>
                        </li>
                        <li class="flex items-center">
                            <span class="connector-badge bg-yellow-100 text-yellow-700">æ›è¨€</span>
                            <span class="text-gray-600">ã¤ã¾ã‚Šã€ã™ãªã‚ã¡</span>
                        </li>
                        <li class="flex items-center">
                            <span class="connector-badge bg-orange-100 text-orange-700">ç†ç”±</span>
                            <span class="text-gray-600">ãªãœãªã‚‰</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="relative group">
                <textarea id="r80Input" 
                          placeholder="ã“ã“ã«æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" 
                          oninput="checkR80()" 
                          rows="5"
                          class="w-full p-6 outline-none resize-none placeholder-gray-400"></textarea>
                
                <div class="absolute bottom-4 right-4 text-sm font-bold text-gray-400">
                    <span id="charCount" class="text-blue-600 text-lg">0</span> / 80
                </div>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="flex justify-end items-center gap-4">
                <span id="autoSaveStatus" class="text-xs text-gray-400 opacity-0 transition-opacity duration-500 font-medium">ä¸‹æ›¸ãä¿å­˜æ¸ˆã¿</span>
                <button onclick="saveR80()" id="saveButton" class="btn-primary py-3 px-8 text-sm font-bold flex items-center gap-2" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                    </svg>
                    å±¥æ­´ã«ä¿å­˜
                </button>
            </div>

            <!-- ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¨ãƒªã‚¢ -->
            <div id="adviceArea" class="status-card bg-gray-50 text-gray-500 text-center py-10">
                å…¥åŠ›ã‚’å§‹ã‚ã‚‹ã¨ã€ã“ã“ã«ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
            </div>

            <!-- å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <section class="pt-10 border-t border-gray-100">
                <div class="flex justify-between items-end mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">éå»ã®è¨˜éŒ²</h2>
                    <button onclick="clearHistory()" class="text-xs text-red-500 hover:text-red-700 font-medium transition">å±¥æ­´ã‚’ã™ã¹ã¦æ¶ˆå»</button>
                </div>
                <div id="historyList" class="rounded-2xl border border-gray-200 overflow-hidden">
                    <p class="text-gray-400 text-center py-8 text-sm">ä¿å­˜ã•ã‚ŒãŸå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </section>
        </div>

        <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼šæ¥ç¶šè©ãƒªã‚¹ãƒˆ (éè¡¨ç¤º) -->
        <div id="tab-connectors" class="hidden fade-in">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">ğŸ“š æ¥ç¶šè©ãƒªã‚¹ãƒˆ</h2>
                <p class="text-gray-500 text-sm">æ–‡è„ˆã«åˆã‚ã›ã¦æœ€é©ãªè¨€è‘‰ã‚’é¸ã³ã¾ã—ã‚‡ã†</p>
            </div>
            
            <div id="connector-list-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- JavaScriptã§ç”Ÿæˆ -->
            </div>

            <div class="mt-12 text-center">
                 <button onclick="switchTab('practice')" class="text-blue-600 font-bold hover:underline transition">
                    â† ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«æˆ»ã‚‹
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- æ¥ç¶šè©ãƒ‡ãƒ¼ã‚¿ã®å®šç¾© ---
        const CONNECTORS_DATA = [
            {
                id: 'conclusion',
                title: 'é †æ¥',
                desc: 'å‰ã®æ–‡ã®çµæœã‚’è¨€ã†',
                basic: ['ã—ãŸãŒã£ã¦', 'ã‚†ãˆã«', 'ã ã‹ã‚‰'],
                advanced: ['ãã®ãŸã‚', 'ãã®çµæœ', 'ã‚ˆã£ã¦', 'ä»¥ä¸Šã®ã“ã¨ã‹ã‚‰', 'ã“ã®ã‚ˆã†ã«', 'ã“ã†ã—ã¦'],
                color: "bg-blue-50 text-blue-800 border-blue-100",
                icon: "â¡ï¸"
            },
            {
                id: 'reverse',
                title: 'é€†æ¥',
                desc: 'åå¯¾ã®ã“ã¨ã‚’è¨€ã†',
                basic: ['ã—ã‹ã—', 'ã ãŒ', 'ã¨ã“ã‚ãŒ'],
                advanced: ['ãã‚Œã§ã‚‚', 'ã¨ã¯ã„ãˆ', 'ãŸã ã—', 'ã—ã‹ã—ãªãŒã‚‰', 'ãã†ã¯è¨€ã£ã¦ã‚‚'],
                color: "bg-red-50 text-red-800 border-red-100",
                icon: "âš¡"
            },
            {
                id: 'parallel',
                title: 'ä¸¦åˆ—ãƒ»ä»˜åŠ ',
                desc: 'åˆ¥ã®ã“ã¨ã‚’ã¤ã‘åŠ ãˆã‚‹',
                basic: ['ã¾ãŸ', 'ãªã‚‰ã³ã«', 'ã‹ã¤'],
                advanced: ['ã•ã‚‰ã«', 'åŠ ãˆã¦', 'ã—ã‹ã‚‚', 'ãã®ä¸Š', 'ã‚ã‚ã›ã¦'],
                color: "bg-green-50 text-green-800 border-green-100",
                icon: "â•"
            },
            {
                id: 'contrast',
                title: 'å¯¾æ¯”',
                desc: 'å‰ã®æ–‡ã¨æ¯”ã¹ã‚‹',
                basic: ['ä¸€æ–¹'],
                advanced: ['ä»–æ–¹', 'ãã‚Œã«å¯¾ã—ã¦', 'åå¯¾ã«', 'é€†ã«', 'å¯¾ç…§çš„ã«'],
                color: "bg-purple-50 text-purple-800 border-purple-100",
                icon: "âš–ï¸"
            },
            {
                id: 'rephrase',
                title: 'æ›è¨€ãƒ»æ•´ç†',
                desc: 'ã‚ã‹ã‚Šã‚„ã™ãè¨€ã„ã‹ãˆã‚‹',
                basic: ['ã¤ã¾ã‚Š', 'ã™ãªã‚ã¡'],
                advanced: ['è¦ã™ã‚‹ã«', 'ã¾ã¨ã‚ã‚‹ã¨', 'è¨€ã„æ›ãˆã‚‹ã¨'],
                color: "bg-yellow-50 text-yellow-800 border-yellow-100",
                icon: "ğŸ”„"
            },
            {
                id: 'reason',
                title: 'ç†ç”±ãƒ»èª¬æ˜',
                desc: 'ã‚ã‘ã‚„ç†ç”±ã‚’è¨€ã†',
                basic: ['ãªãœãªã‚‰'],
                advanced: ['ã¨ã„ã†ã®ã‚‚', 'ãã®ç†ç”±ã¯', 'ãªãœã‹ã¨ã„ã†ã¨'],
                // åˆ¤å®šç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼šBasicã€Advancedã«åŠ ãˆã€ã€Œç†ç”±ã¯ã€ã‚’è¿½åŠ 
                checkKeywords: ['ãªãœãªã‚‰', 'ã¨ã„ã†ã®ã‚‚', 'ãã®ç†ç”±ã¯', 'ãªãœã‹ã¨ã„ã†ã¨', 'ç†ç”±ã¯'],
                color: "bg-orange-50 text-orange-800 border-orange-100",
                icon: "ğŸ’¡"
            },
            {
                id: 'concrete',
                title: 'å…·ä½“åŒ–',
                desc: 'ãã‚ã—ã„ä¾‹ã‚’å‡ºã™',
                basic: [],
                advanced: ['ä¾‹ãˆã°', 'å…·ä½“çš„ã«ã¯', 'ä¾‹ã‚’æŒ™ã’ã‚‹ã¨', 'å®Ÿéš›ã«'],
                color: "bg-teal-50 text-teal-800 border-teal-100",
                icon: "ğŸ”"
            },
            {
                id: 'condition',
                title: 'æ¡ä»¶ãƒ»ä»®å®š',
                desc: 'ã‚‚ã—ã‚‚ã®è©±ã‚’ã™ã‚‹',
                basic: [],
                advanced: ['ã‚‚ã—ã€œãªã‚‰', 'ä»®ã«ã€œã¨ã™ã‚‹ã¨'],
                checkKeywords: ['ã‚‚ã—', 'ä»®ã«'],
                color: "bg-gray-100 text-gray-800 border-gray-200",
                icon: "â“"
            }
        ];

        // åˆ¤å®šç”¨ãƒ•ãƒ©ãƒƒãƒˆãƒªã‚¹ãƒˆã®ç”Ÿæˆ
        let CONNECTORS_FLAT = [];
        CONNECTORS_DATA.forEach(cat => {
            // åŸºæœ¬
            CONNECTORS_FLAT = CONNECTORS_FLAT.concat(cat.basic);
            // æ‹¡å¼µ or åˆ¤å®šç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
            if (cat.checkKeywords) {
                CONNECTORS_FLAT = CONNECTORS_FLAT.concat(cat.checkKeywords);
            } else {
                CONNECTORS_FLAT = CONNECTORS_FLAT.concat(cat.advanced);
            }
        });
        CONNECTORS_FLAT = [...new Set(CONNECTORS_FLAT)];

        // --- æ¥ç¶šè©ä¸€è¦§ã®ç”Ÿæˆ ---
        function renderConnectorList() {
            const container = document.getElementById('connector-list-container');
            if (!container) return; 
            container.innerHTML = "";

            let html = "";
            CONNECTORS_DATA.forEach(cat => {
                if (!cat.advanced || cat.advanced.length === 0) return;

                const chips = cat.advanced.map(word => `<span class="inline-block bg-white px-3 py-1.5 rounded-full border border-gray-200 text-gray-600 text-sm font-medium mr-2 mb-2 shadow-sm">${word}</span>`).join("");
                
                html += `
                    <div class="rounded-3xl p-6 border ${cat.color.split(' ')[2]} ${cat.color.split(' ')[0]} bg-opacity-30">
                        <h4 class="font-bold text-lg mb-4 flex items-center ${cat.color.split(' ')[1]}">
                            <span class="mr-3 text-xl">${cat.icon}</span> ${cat.title} 
                            <span class="text-sm font-normal ml-2 opacity-80 bg-white bg-opacity-50 px-2 py-0.5 rounded-md"> ${cat.desc}</span>
                        </h4>
                        <div class="flex flex-wrap">
                            ${chips}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
        
        // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ ---
        function switchTab(tabName) {
            const tabPractice = document.getElementById('tab-practice');
            const tabConnectors = document.getElementById('tab-connectors');
            const btnPractice = document.getElementById('btn-practice');
            const btnConnectors = document.getElementById('btn-connectors');

            if (tabName === 'practice') {
                tabPractice.classList.remove('hidden');
                tabConnectors.classList.add('hidden');
                btnPractice.classList.add('tab-active');
                btnConnectors.classList.remove('tab-active');
                setTimeout(() => {
                    const input = document.getElementById('r80Input');
                    if(input) input.focus();
                }, 100);
            } else {
                tabPractice.classList.add('hidden');
                tabConnectors.classList.remove('hidden');
                btnPractice.classList.remove('tab-active');
                btnConnectors.classList.add('tab-active');
                renderConnectorList();
            }
        }

        const MAX_CHARS = 80;
        let isCurrentR80Valid = false; 

        // å…¥åŠ›æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ãƒ¡ã‚¤ãƒ³ã®ãƒã‚§ãƒƒã‚¯é–¢æ•°
        function checkR80() {
            const inputElement = document.getElementById('r80Input');
            const input = inputElement.value.trim();
            const adviceArea = document.getElementById('adviceArea');
            const charCountSpan = document.getElementById('charCount');
            const saveButton = document.getElementById('saveButton');
            const autoSaveStatus = document.getElementById('autoSaveStatus');
            
            // --- ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ– ---
            if (input !== localStorage.getItem('r80Draft')) {
                localStorage.setItem('r80Draft', inputElement.value);
                autoSaveStatus.classList.remove('opacity-0');
                setTimeout(() => {
                    autoSaveStatus.classList.add('opacity-0');
                }, 2000);
            }

            // æ–‡å­—æ•°æ›´æ–°
            charCountSpan.textContent = input.length;
            
            // ç©ºã®å ´åˆã®ãƒªã‚»ãƒƒãƒˆ
            if (input.length === 0) {
                adviceArea.innerHTML = 'å…¥åŠ›ã‚’å§‹ã‚ã‚‹ã¨ã€ã“ã“ã«ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™';
                adviceArea.className = 'status-card bg-gray-50 text-gray-500 text-center py-10';
                saveButton.disabled = true;
                isCurrentR80Valid = false;
                return;
            }

            let adviceHTML = '';
            let isPerfect = true;
            let statusClass = 'bg-success'; 

            // --- 1. æ–‡å­—æ•°ãƒã‚§ãƒƒã‚¯ ---
            if (input.length > MAX_CHARS + 20) { 
                adviceHTML += '<div class="mb-2 font-bold text-red-600">âš ï¸ æ–‡å­—æ•°ãŒå¤šã™ãã¾ã™</div><div class="text-sm text-red-800">ã‚‚ã£ã¨çŸ­ãã€é‹­ãã¾ã¨ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</div>';
                isPerfect = false;
                statusClass = 'bg-warning';
            } else if (input.length > MAX_CHARS) {
                adviceHTML += '<div class="mb-2 font-bold text-red-600">âš ï¸ 80å­—ã‚’è¶…ãˆã¦ã„ã¾ã™ï¼</div><div class="text-sm text-red-800">è¨€è‘‰ã‚’å‰Šãè½ã¨ã—ã¦ã€80å­—ä»¥å†…ã«ã¾ã¨ã‚ã¾ã—ã‚‡ã†ã€‚</div>';
                isPerfect = false;
                if (statusClass === 'bg-success') statusClass = 'bg-warning';
            } else if (input.length >= 72) {
                adviceHTML += '<div class="mb-2 font-bold text-green-700">âœ… æ–‡å­—æ•°ã¯ãƒãƒƒãƒãƒªã§ã™ï¼</div>';
            } else if (input.length >= 64) {
                adviceHTML += '<div class="mb-2 font-bold text-green-700">âœ… æ–‡å­—æ•°ã¯OKã§ã™</div><div class="text-sm text-green-800">ï¼ˆã•ã‚‰ã«è©³ã—ãæ›¸ã„ã¦ã‚‚è‰¯ã„ã§ã™ã­ï¼‰</div>';
            } else if (input.length > 40) {
                 adviceHTML += '<div class="mb-2 font-bold text-blue-600">ğŸ’¡ ã‚ã¨ã‚‚ã†å°‘ã—</div><div class="text-sm text-blue-800">64æ–‡å­—ä»¥ä¸Šã‚’ç›®æŒ‡ã—ã¦è©³ã—ãæ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</div>';
                 isPerfect = false; 
                 if (statusClass === 'bg-success') statusClass = 'bg-info';
            } else { // 40æ–‡å­—ä»¥ä¸‹
                adviceHTML += '<div class="mb-2 font-bold text-yellow-600">âš ï¸ æ–‡å­—æ•°ãŒå°‘ãªã‚ã§ã™</div><div class="text-sm text-yellow-800">ã‚‚ã†å°‘ã—è©³ã—ãæ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼</div>';
                isPerfect = false; 
                if (statusClass === 'bg-success') statusClass = 'bg-warning';
            }

            // --- 2. 2æ–‡æ§‹æˆãƒã‚§ãƒƒã‚¯ ---
            const periodCount = (input.match(/ã€‚/g) || []).length;
            if (periodCount === 2) {
                adviceHTML += '<hr class="my-3 border-black/5"><div class="mb-2 font-bold text-green-700">âœ… 2æ–‡ã§æ›¸ã‘ã¦ã„ã¾ã™ï¼ãƒãƒƒãƒãƒªã§ã™ï¼</div>';
            } else if (periodCount < 2) {
                adviceHTML += '<hr class="my-3 border-black/5"><div class="mb-2 font-bold text-red-600">âŒ ã€Œã€‚ã€ãŒè¶³ã‚Šã¾ã›ã‚“</div><div class="text-sm text-red-800">äº‹å®Ÿã¨è€ƒå¯Ÿã‚’åˆ†ã‘ã¦ã€2æ–‡ã«ã—ã¾ã—ã‚‡ã†ã€‚</div>';
                isPerfect = false;
                if (statusClass !== 'bg-error') statusClass = 'bg-error';
            } else {
                adviceHTML += '<hr class="my-3 border-black/5"><div class="mb-2 font-bold text-yellow-600">âš ï¸ ã€Œã€‚ã€ãŒå¤šã™ãã¾ã™</div><div class="text-sm text-yellow-800">è¨€ã„ãŸã„ã“ã¨ã‚’2ã¤ã«çµã‚Šã¾ã—ã‚‡ã†ã€‚</div>';
                if (statusClass === 'bg-success') statusClass = 'bg-warning';
            }

            // --- 3. æ¥ç¶šè©ãƒã‚§ãƒƒã‚¯ ---
            let foundConnector = null;
            let connectorIndex = -1;
            const firstPeriodIndex = input.indexOf('ã€‚');

            if (periodCount >= 2 && firstPeriodIndex !== -1) {
                const secondSentenceStart = input.substring(firstPeriodIndex + 1).trim();
                foundConnector = CONNECTORS_FLAT.find(c => secondSentenceStart.startsWith(c));
                
                if (foundConnector) {
                    connectorIndex = firstPeriodIndex + 1 + input.substring(firstPeriodIndex + 1).indexOf(foundConnector);
                }
            }

            if (!foundConnector) {
                adviceHTML += '<hr class="my-3 border-black/5"><div class="mb-2 font-bold text-red-600">âŒ æ¥ç¶šè©ãŒå¿…è¦ã§ã™</div><div class="text-sm text-red-800">2æ–‡ç›®ã®æœ€åˆã«ã€æ–‡ã‚’ã¤ãªãè¨€è‘‰ã‚’ç½®ãã¾ã—ã‚‡ã†ã€‚</div>';
                isPerfect = false;
                if (statusClass !== 'bg-error') statusClass = 'bg-error';
            } else {
                adviceHTML += `<hr class="my-3 border-black/5"><div class="mb-2 font-bold text-green-700">âœ… æ¥ç¶šè©ã€Œ${foundConnector}ã€ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™</div>`;

                // èª­ç‚¹ãƒã‚§ãƒƒã‚¯
                const textAfterConnector = input.substring(connectorIndex + foundConnector.length).trim();
                if (!textAfterConnector.startsWith('ã€')) {
                     adviceHTML += '<div class="text-sm text-yellow-700 mt-1 bg-yellow-50 p-2 rounded">ğŸ’¡ æ¥ç¶šè©ã®å¾Œã«ã€Œã€ã€ã‚’å…¥ã‚Œã‚‹ã¨ã€ã‚‚ã£ã¨èª­ã¿ã‚„ã™ããªã‚Šã¾ã™ã‚ˆã€‚</div>';
                }

                // å…ˆç”Ÿã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
                let checkQuestion = '';
                const cat = CONNECTORS_DATA.find(c => {
                    const list = c.checkKeywords ? c.checkKeywords : c.advanced.concat(c.basic);
                    return list.includes(foundConnector);
                });

                if (cat) {
                    if (cat.id === 'reason') checkQuestion = '1æ–‡ç›®ã®ã€Œæ ¹æ‹ ã€ãŒã—ã£ã‹ã‚Šã¨æ›¸ã‘ã¦ã„ã¾ã™ã‹ï¼Ÿ';
                    else if (cat.id === 'conclusion') checkQuestion = '1æ–‡ç›®ã®äº‹å®Ÿã‹ã‚‰ã€ç„¡ç†ãªãå°ã‘ã‚‹ã€Œçµè«–ã€ã«ãªã£ã¦ã„ã¾ã™ã‹ï¼Ÿ';
                    else if (cat.id === 'reverse') checkQuestion = 'äºˆæƒ³å¤–ã®çµæœã‚„ã€åå¯¾ã®æ„è¦‹ã‚’é®®ã‚„ã‹ã«åˆ‡ã‚Šå‡ºã›ã¦ã„ã¾ã™ã‹ï¼Ÿ';
                    else if (cat.id === 'contrast') checkQuestion = '2ã¤ã®äº‹æŸ„ã‚’ç¶ºéº—ã«å¯¾æ¯”ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ';
                    else if (cat.id === 'parallel') checkQuestion = 'å‰ã®æ–‡ã®å†…å®¹ã«ã€é‡è¦ãªæƒ…å ±ã‚’ç©ã¿ä¸Šã’ã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ';
                    else if (cat.id === 'rephrase') checkQuestion = 'å‰ã®æ–‡ã‚’ã€ã‚‚ã£ã¨åˆ†ã‹ã‚Šã‚„ã™ã„è¨€è‘‰ã§è¨€ã„æ›ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ';
                    else if (cat.id === 'concrete') checkQuestion = 'æŠ½è±¡çš„ãªè©±ã‚’ã€å…·ä½“çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã§ãã‚‹ä¾‹ã«è½ã¨ã—è¾¼ã‚ã¦ã„ã¾ã™ã‹ï¼Ÿ';
                    else if (cat.id === 'condition') checkQuestion = 'æ€è€ƒå®Ÿé¨“ã¨ã—ã¦ã€ä»®å®šã®è©±ã‚’å±•é–‹ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ';
                }

                if (checkQuestion) {
                    adviceHTML += `
                        <div class="mt-4 p-5 bg-white rounded-2xl shadow-sm border border-gray-100 text-left">
                            <div class="mb-3 pb-3 border-b border-gray-100">
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">ã‚ãªãŸãŒä½¿ç”¨ã—ãŸæ¥ç¶šè©</span>
                                <div class="text-lg font-bold text-blue-600 mt-1">ã€Œ${foundConnector}ã€</div>
                            </div>
                            <div class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-2">ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯</div>
                            <div class="flex items-start gap-3">
                               <span class="text-2xl">ğŸ¤”</span>
                               <div class="font-bold text-gray-800 text-sm leading-relaxed pt-1">${checkQuestion}</div>
                            </div>
                        </div>
                    `;
                }
            }
            
            // --- æœ€çµ‚è©•ä¾¡ & ä¿å­˜ãƒœã‚¿ãƒ³åˆ¶å¾¡ ---
            if (isPerfect && input.length > 0) {
                const successMsg = `
                    <div class="text-center pb-4">
                        <div class="text-5xl mb-3">ğŸ‰</div>
                        <h3 class="text-xl font-bold text-green-800 mb-1">ç´ æ™´ã‚‰ã—ã„ï¼R80å®Œæˆã§ã™ï¼</h3>
                        <p class="text-green-700 text-sm opacity-80">
                            åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã¯ãƒãƒƒãƒãƒªã§ã™ã€‚<br>
                            æ¬¡ã¯ã€èª­ã¿æ‰‹ã«ã€Œãªã‚‹ã»ã©ï¼ã€ã¨æ€ã‚ã›ã‚‹ã‚ˆã†ãªã€<br>
                            æ·±ã„è€ƒå¯ŸãŒã§ãã¦ã„ã‚‹ã‹è¦‹ç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
                        </p>
                    </div>
                `;
                adviceHTML = successMsg + '<div class="mt-4 border-t border-green-200 pt-4 opacity-80 text-sm text-left">' + adviceHTML + '</div>';
                
                adviceArea.className = 'status-card bg-green-50 border-green-200';
                saveButton.disabled = false;
                isCurrentR80Valid = true;
            } else {
                 adviceArea.className = `status-card text-left ${statusClass}`;
                 saveButton.disabled = true;
                 isCurrentR80Valid = false;
            }

            adviceArea.innerHTML = adviceHTML;
        }

        // --- ä¿å­˜æ©Ÿèƒ½ (LocalStorage) ---
        function saveR80() {
            if (!isCurrentR80Valid) return;

            const input = document.getElementById('r80Input').value;
            const now = new Date();
            const dateStr = `${now.getMonth() + 1}/${now.getDate()} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            const record = {
                text: input,
                date: dateStr,
                id: Date.now()
            };

            let history = JSON.parse(localStorage.getItem('r80History') || '[]');
            history.unshift(record);
            localStorage.setItem('r80History', JSON.stringify(history));

            localStorage.removeItem('r80Draft');
            document.getElementById('r80Input').value = '';
            
            checkR80(); 
            loadHistory();
            
            alert('å±¥æ­´ã«ä¿å­˜ã—ã¾ã—ãŸ');
        }

        function loadHistory() {
            const historyList = document.getElementById('historyList');
            const history = JSON.parse(localStorage.getItem('r80History') || '[]');

            if (history.length === 0) {
                historyList.innerHTML = '<p class="text-gray-400 text-center py-8 text-sm">ä¿å­˜ã•ã‚ŒãŸå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            let html = '';
            history.forEach(item => {
                html += `
                    <div class="history-item p-6 flex flex-col sm:flex-row justify-between items-start gap-4">
                        <div class="flex-1">
                            <div class="text-xs font-bold text-gray-400 mb-1">${item.date}</div>
                            <p class="text-gray-800 font-medium whitespace-pre-wrap leading-relaxed">${escapeHtml(item.text)}</p>
                        </div>
                        <button onclick="deleteItem(${item.id})" class="text-gray-300 hover:text-red-500 transition p-2" title="å‰Šé™¤">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                `;
            });
            historyList.innerHTML = html;
        }

        function deleteItem(id) {
            if(!confirm('ã“ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            let history = JSON.parse(localStorage.getItem('r80History') || '[]');
            history = history.filter(item => item.id !== id);
            localStorage.setItem('r80History', JSON.stringify(history));
            loadHistory();
        }

        function clearHistory() {
            if(!confirm('å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
            localStorage.removeItem('r80History');
            loadHistory();
        }

        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderConnectorList();

            const draft = localStorage.getItem('r80Draft');
            const inputElement = document.getElementById('r80Input');
            if (draft && inputElement) {
                inputElement.value = draft;
            }
            
            if(inputElement) inputElement.focus();
            checkR80();
            loadHistory();
        });
    </script>
</body>
</html>
