<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>『故郷』徹底解剖データファイル</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700;900&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                        serif: ['"Noto Serif JP"', 'serif'],
                    },
                    colors: {
                        surface: '#ffffff',
                        background: '#f5f5f7', // Apple-like light gray
                        primary: '#1d1d1f',    // Apple-like black
                        secondary: '#86868b',  // Apple-like gray
                        accent: '#0071e3',     // Apple-like blue
                        money: '#34c759',      // Apple-like green
                        heart: '#ff3b30',      // Apple-like red
                    },
                    boxShadow: {
                        'apple': '0 4px 24px rgba(0, 0, 0, 0.04)',
                        'apple-hover': '0 8px 32px rgba(0, 0, 0, 0.08)',
                        'floating': '0 20px 40px rgba(0,0,0,0.1)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    },
                    animation: {
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* App Shell Structure */
        html, body { 
            height: 100%;
            width: 100%;
            overflow: hidden; /* Disable scrolling on body */
            background-color: #f5f5f7; 
            color: #1d1d1f; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #root {
            height: 100%;
            width: 100%;
        }
        
        /* Safe area for mobile/tablet */
        .safe-area-pb {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Custom Scrollbar for the scrollable area */
        .scroll-container::-webkit-scrollbar {
            width: 6px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .scroll-container::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.1);
            border-radius: 3px;
        }
        
        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            /* Force GPU acceleration for fixed positioning on tablets */
            transform: translateZ(0);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect } = React;

        // --- Icons Wrapper (Safe for React) ---
        // This component wraps the Lucide icon generation in a way that doesn't conflict with React's DOM management
        const DynamicIcon = ({ name, className, size = 24 }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (!containerRef.current || !window.lucide) return;

                // Manually inject the <i> tag into the container
                // This isolates the DOM manipulation from React
                containerRef.current.innerHTML = `<i data-lucide="${name}" class="${className || ''}"></i>`;
                
                // Ask Lucide to render icons specifically within this container
                window.lucide.createIcons({
                    root: containerRef.current,
                    attrs: {
                        width: size,
                        height: size
                    }
                });
            }, [name, className, size]);

            // Render a container that React manages, but React doesn't touch its children
            return <span ref={containerRef} style={{ display: 'inline-flex', lineHeight: 0 }} />;
        };

        // --- Data ---
        const questions = [
            {
                category: "カテゴリーA：【もしも…】",
                subtitle: "お金の条件を変えて本心を探る",
                icon: "banknote", color: "text-emerald-700", bg: "bg-emerald-100", border: "border-emerald-200",
                items: [
                    { 
                        id: 1, 
                        q: "もし閏土が宝くじに当たって大金持ちになっていたら、「私」を「旦那様」と呼んだかな？", 
                        options: [
                            { type: 'money', label: "呼ばない", sub: "「やあ、迅ちゃん！」と呼ぶ", reason: "「お金さえあれば対等になれた」と考えているからです。今の卑屈な態度は性格ではなく、貧しさが作らせたものだと捉えています。" }, 
                            { type: 'heart', label: "やっぱり呼ぶ", sub: "金持ちでも丁寧語を使う", reason: "「お金があっても、染み付いた身分意識や上下関係は消えない」と考えているからです。壁の原因は心の中のルールにあります。" }
                        ] 
                    },
                    { 
                        id: 2, 
                        q: "もし「私」が大富豪で、「閏ちゃん、これ100万円あげるよ」と言ったら、二人の壁は消えたかな？", 
                        options: [
                            { type: 'money', label: "消える", sub: "泣いて感謝して仲良くなる", reason: "今の気まずさは、「助けてあげられない無力感」や「生活の苦しさ」から来ていると考えているからです。解決策（カネ）があれば壁は壊せます。" }, 
                            { type: 'heart', label: "消えない", sub: "逆に恐縮して距離ができる", reason: "「施し（めぐみ）」を受けることで、余計に惨めさや上下関係が強調されると考えているからです。心の距離はお金では買えません。" }
                        ] 
                    }
                ]
            },
            {
                category: "カテゴリーB：【場面転換】",
                subtitle: "場所や状況を変えてみる",
                icon: "message-circle", color: "text-blue-700", bg: "bg-blue-100", border: "border-blue-200",
                items: [
                    { 
                        id: 3, 
                        q: "もし二人がスタバのようなカフェに入って、2時間お茶をすることになったら、会話は続く？", 
                        options: [
                            { type: 'money', label: "続かない", sub: "沈黙しちゃう", reason: "仲が悪いのではなく、単に「共通の話題」がないだけだと捉えています。話題の差は、教育や旅などの「経験（カネで買うもの）」の差です。" }, 
                            { type: 'heart', label: "続く", sub: "昔話で盛り上がる", reason: "本来なら話せるはずなのに、会話がなかったのは「私」が勝手に期待して、勝手にガッカリした（心を閉ざした）からだと捉えています。" }
                        ] 
                    },
                    { 
                        id: 4, 
                        q: "もし周りに誰もいなくて、完全な二人きりの密室だったら、閏土は「迅ちゃん」と呼べたかな？", 
                        options: [
                            { type: 'money', label: "呼べた", sub: "甘えられた", reason: "閏土が他人行儀なのは、本心からではなく「周りの目」や「村の空気」を気にしているからだと捉えています。貧しい村の空気が彼を縛っています。" }, 
                            { type: 'heart', label: "呼べない", sub: "やっぱり無理", reason: "誰が見ていなくても、閏土自身のプライドや恐怖心が邪魔をすると考えているからです。「落ちぶれた自分」を認めたくないという心理が壁です。" }
                        ] 
                    }
                ]
            },
            {
                category: "カテゴリーC：【変化の正体】",
                subtitle: "見た目と中身のギャップ",
                icon: "eye", color: "text-amber-700", bg: "bg-amber-100", border: "border-amber-200",
                items: [
                    { 
                        id: 5, 
                        q: "もし閏土が、昔と同じツヤツヤした健康的な顔のままだったら、「私」は言葉を失ったかな？", 
                        options: [
                            { type: 'money', label: "失わない", sub: "「変わらないね！」と抱きつく", reason: "「私」がショックを受けた最大の原因は「見た目の老化」だと捉えています。その老化の原因は、過酷な労働（カネの問題）にあります。" }, 
                            { type: 'heart', label: "失う", sub: "やっぱり話が続かない", reason: "見た目が若くても、信じているもの（科学vs迷信）が違えば、やっぱり話は噛み合わないと考えているからです。" }
                        ] 
                    },
                    { 
                        id: 6, 
                        q: "閏土が去り際に「香炉（神様グッズ）」じゃなくて、「現金」を欲しがったら、「私」はどう思った？", 
                        options: [
                            { type: 'money', label: "納得する", sub: "まあ、生活苦しいもんね", reason: "香炉だろうが現金だろうが、結局は「生きるために必要なもの」だと捉えています。形が違うだけで、根本原因は貧困です。" }, 
                            { type: 'heart', label: "軽蔑する", sub: "えっ、がめついな", reason: "「私」は美しい思い出や「品格」を求めているから、生々しい現実を突きつけられると引いてしまう（心を閉ざす）と考えているからです。" }
                        ] 
                    }
                ]
            },
            {
                category: "カテゴリーD：【未来予測】",
                subtitle: "次世代（水生と宏児）の関係",
                icon: "users", color: "text-indigo-700", bg: "bg-indigo-100", border: "border-indigo-200",
                items: [
                    { 
                        id: 7, 
                        q: "10年後、水生（閏土の子）と宏児（私の子）が再会したら、二人は仲良くなれる？", 
                        options: [
                            { type: 'money', label: "なれない", sub: "水生が「旦那様」と呼ぶ", reason: "結局、水生は学校に行けず、宏児はエリートになるからです。親と同じ「経済格差」の道を辿る以上、同じ壁ができると考えます。" }, 
                            { type: 'heart', label: "なれる", sub: "対等に話す", reason: "もし仲良くなれるなら、今の二人に壁があるのは「古い時代の教育（身分意識）」のせいだからです。新しい心を持った世代なら、壁は越えられます。" }
                        ] 
                    }
                ]
            },
            {
                category: "カテゴリーE：【罪と罰】",
                subtitle: "「灰の中の食器」事件",
                icon: "gavel", color: "text-orange-700", bg: "bg-orange-100", border: "border-orange-200",
                items: [
                    { 
                        id: 8, 
                        q: "閏土が「灰の中に食器を隠した」と聞いた時、君はどう感じた？", 
                        options: [
                            { type: 'money', label: "同情する", sub: "なりふり構わないほど苦しかった", reason: "あの行為を「盗み（悪）」ではなく「生存戦略」と捉えているからです。プライドを捨てさせるほどの貧困が原因だと考えています。" }, 
                            { type: 'heart', label: "ショック", sub: "純朴な閏土は死んでしまった", reason: "貧しさそのものより、心が卑しく変わってしまったこと（道徳心の低下）に絶望を感じているからです。これは心の問題です。" }
                        ] 
                    },
                    { 
                        id: 9, 
                        q: "もし楊おばさんがいなくて、村がもっと平和だったら、閏土は食器を盗んだかな？", 
                        options: [
                            { type: 'money', label: "盗まない", sub: "平和に暮らす", reason: "閏土個人が悪いのではなく、村全体を覆う「奪い合いの空気（貧困の連鎖）」が彼を追い詰めたと考えているからです。" }, 
                            { type: 'heart', label: "盗む", sub: "やっぱりチャンスがあればやる", reason: "周囲の環境に関係なく、今の閏土の心はすでに麻痺し、倫理観が壊れていると捉えているからです。" }
                        ] 
                    }
                ]
            },
            {
                category: "カテゴリーF：【責任の所在】",
                subtitle: "悪いのは誰だ？",
                icon: "brain", color: "text-purple-700", bg: "bg-purple-100", border: "border-purple-200",
                items: [
                    { 
                        id: 10, 
                        q: "閏土が「石像（木偶の坊）」みたいになった一番の犯人は何だと思う？", 
                        options: [
                            { type: 'money', label: "社会システム", sub: "軍閥・重税・地主", reason: "個人の努力ではどうにもならない「社会システム（カネの搾取構造）」が人間を壊したと考えているからです。" }, 
                            { type: 'heart', label: "古い慣習", sub: "伝統・迷信・教育不足", reason: "彼を縛っているのは税金だけでなく、「こう生きるしかない」という思い込みや、古い慣習（心の中の鎖）だと考えているからです。" }
                        ] 
                    },
                    { 
                        id: 11, 
                        q: "もし閏土が、現代の日本に生まれていたら、「私」と親友になれたかな？", 
                        options: [
                            { type: 'money', label: "なれた", sub: "普通の友達になる", reason: "現代日本のように極端な貧困や飢餓がなければ、性格自体は合うはずだと考えているからです。邪魔をしていたのは環境（カネ）だけです。" }, 
                            { type: 'heart', label: "なれない", sub: "やっぱり話が合わない", reason: "結局、進学するコースや興味関心が違えば、話は合わなくなると考えているからです。人間としての「住む世界（価値観）」の違いは埋まりません。" }
                        ] 
                    }
                ]
            },
            {
                category: "カテゴリーG：【希望の行方】",
                subtitle: "ラストシーンの解釈",
                icon: "arrow-right", color: "text-cyan-700", bg: "bg-cyan-100", border: "border-cyan-200",
                items: [
                    { 
                        id: 12, 
                        q: "最後の「歩く人が多くなれば道になる」という希望。これを実現するために、一番必要なのはどっち？", 
                        options: [
                            { type: 'money', label: "豊かさ", sub: "政治が変わって、みんなが豊かになること", reason: "貧困が解決しない限り、誰もが自分の生活で手一杯で、道を作る（新しい関係を築く）余裕なんて生まれないと捉えているからです。" }, 
                            { type: 'heart', label: "意識改革", sub: "みんなが意識を変えて、偶像（迷信）を捨てること", reason: "いくら豊かになっても、差別意識や依存心がある限り、本当の「新しい生活」は来ないと捉えているからです。革命は心の中で起きるべきものです。" }
                        ] 
                    },
                    { 
                        id: 13, 
                        q: "宏児（私の子）と水生（閏土の子）が、将来「厚い壁」を感じないために必要なアイテムは？", 
                        options: [
                            { type: 'money', label: "ツール", sub: "スマホやチケット（カネ）", reason: "連絡を取り合ったり会いに行ったりする「経済的な余裕」さえあれば、関係は維持できると考えているからです。" }, 
                            { type: 'heart', label: "精神力", sub: "勇気や偏見のない心", reason: "親が決めた身分や格差を飛び越えるには、強い意志（心）が必要だと考えているからです。" }
                        ] 
                    }
                ]
            },
            {
                category: "カテゴリーH：【私への疑惑】",
                subtitle: "「私」の視点を疑う",
                icon: "help-circle", color: "text-rose-700", bg: "bg-rose-100", border: "border-rose-200",
                items: [
                    { 
                        id: 14, 
                        q: "「私」は楊おばさんを「コンパス」、閏土を「石像」と呼んだ。このあだ名についてどう思う？", 
                        options: [
                            { type: 'money', label: "うまい例え", sub: "特徴を捉えてるな", reason: "「私」の視点を客観的で正しいものとして受け入れています。つまり、「私」のせいではなく、客観的な事実（貧困による変化）が原因だと考えがちです。" }, 
                            { type: 'heart', label: "ひどいな", sub: "見下してるな", reason: "「私」の中に、無自覚な差別意識や冷たさを感じ取っているからです。その「上から目線」こそが壁を作った犯人です。" }
                        ] 
                    },
                    { 
                        id: 15, 
                        q: "「私」が故郷を離れる時、「名残惜しい気はしない」と言った。これは本心？", 
                        options: [
                            { type: 'money', label: "本心", sub: "もう未練はない", reason: "故郷はもう「生きられない場所（貧困の地）」になってしまった。現実的に生活を立て直すには、捨てるしかないという判断です。" }, 
                            { type: 'heart', label: "強がり", sub: "本当は悲しい", reason: "期待していた「美しい故郷」が壊れてしまったことへの、精神的なショックを隠そうとしているからです。" }
                        ] 
                    }
                ]
            }
        ];

        // --- Components ---
        const Diagnosis = ({ answers, onAnswer }) => {
            const [expandedCards, setExpandedCards] = useState({});

            const toggleExpand = (id) => setExpandedCards(prev => ({ ...prev, [id]: !prev[id] }));

            const handleLocalAnswer = (qId, type) => {
                onAnswer(qId, type);
                // Automatically open explanation
                if (!expandedCards[qId]) {
                    setExpandedCards(prev => ({ ...prev, [qId]: true }));
                }
            };

            return (
                <div className="pb-40 slide-in">
                    <div className="space-y-12">
                        {questions.map((category, idx) => (
                            <section key={idx} className="relative">
                                {/* Category Header */}
                                <div className={`flex items-center gap-4 mb-6 px-4 py-6 rounded-3xl shadow-sm border ${category.bg} ${category.border}`}>
                                    <div className="bg-white/60 p-3 rounded-2xl shadow-sm backdrop-blur-sm shrink-0">
                                        <DynamicIcon name={category.icon} className={category.color} size={28} />
                                    </div>
                                    <div>
                                        <h3 className={`font-black text-xl md:text-2xl ${category.color} tracking-tight`}>{category.category}</h3>
                                        <p className={`${category.color} text-sm font-bold opacity-80 mt-1`}>{category.subtitle}</p>
                                    </div>
                                </div>

                                <div className="grid gap-6 px-1">
                                    {category.items.map((item) => {
                                        const isAnswered = answers[item.id] !== undefined;
                                        const isExpanded = expandedCards[item.id];
                                        const currentAnswer = answers[item.id];

                                        return (
                                            <div key={item.id} className={`bg-white rounded-3xl shadow-apple hover:shadow-apple-hover transition-all duration-300 border ${isAnswered ? 'border-slate-300' : 'border-white'}`}>
                                                <div className="p-6 md:p-8">
                                                    <div className="flex gap-3 mb-6">
                                                        <span className="bg-slate-100 text-slate-500 text-[10px] font-bold px-2 py-1 rounded-full h-fit font-serif tracking-widest shrink-0">Q{item.id}</span>
                                                        <p className="font-bold text-lg md:text-xl text-primary leading-relaxed">{item.q}</p>
                                                    </div>
                                                    
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        {item.options.map((opt) => (
                                                            <button 
                                                                key={opt.type} 
                                                                onClick={() => handleLocalAnswer(item.id, opt.type)}
                                                                className={`relative p-5 rounded-2xl text-left border-2 transition-all duration-200 w-full ${
                                                                    currentAnswer === opt.type 
                                                                        ? (opt.type === 'money' ? 'bg-emerald-50 border-emerald-500' : 'bg-rose-50 border-rose-500')
                                                                        : 'bg-background border-transparent hover:border-slate-200 hover:bg-slate-50'
                                                                }`}
                                                            >
                                                                <div className="flex justify-between items-center w-full mb-1">
                                                                    <div className={`font-bold text-lg ${
                                                                        currentAnswer === opt.type 
                                                                            ? (opt.type === 'money' ? 'text-emerald-700' : 'text-rose-700') 
                                                                            : 'text-primary'
                                                                    }`}>
                                                                        {opt.label}
                                                                    </div>
                                                                    {currentAnswer === opt.type && (
                                                                        <DynamicIcon name="check-circle" size={20} className={opt.type === 'money' ? 'text-emerald-600' : 'text-rose-600'}/>
                                                                    )}
                                                                </div>
                                                                <div className="text-sm text-secondary font-medium">{opt.sub}</div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                                
                                                <div className={`overflow-hidden transition-all duration-500 ${isExpanded ? 'max-h-[600px] opacity-100' : 'max-h-0 opacity-0'}`}>
                                                    <div className="bg-slate-50/50 border-t border-slate-100 p-6 md:p-8">
                                                        <div className="flex gap-4">
                                                            <div className={`w-1 rounded-full shrink-0 ${currentAnswer === 'money' ? 'bg-money' : 'bg-heart'}`}></div>
                                                            <div>
                                                                <p className={`text-xs font-bold uppercase tracking-wider mb-2 ${currentAnswer === 'money' ? 'text-emerald-700' : 'text-rose-700'}`}>
                                                                    診断結果：{currentAnswer === 'money' ? 'カネ（経済格差）派' : '心（精神格差）派'}
                                                                </p>
                                                                <p className="text-primary text-base leading-7">
                                                                    <span className="font-bold mr-1">なぜなら、あなたは</span>
                                                                    {item.options.find(o => o.type === currentAnswer)?.reason}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {isAnswered && (
                                                    <button onClick={() => toggleExpand(item.id)} className="w-full text-center py-4 text-xs font-bold text-secondary hover:text-primary hover:bg-slate-50 border-t border-slate-100 flex items-center justify-center gap-2 transition-colors rounded-b-3xl">
                                                        {isExpanded 
                                                            ? <span>解説を閉じる <DynamicIcon name="chevron-up" size={14}/></span>
                                                            : <span>解説を読む <DynamicIcon name="chevron-down" size={14}/></span>
                                                        }
                                                    </button>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </section>
                        ))}
                    </div>
                </div>
            );
        };

        const Reference = () => {
            return (
                <div className="space-y-16 animate-slide-up pb-12">
                    {/* Header Section */}
                    <section className="text-center mb-12">
                        <div className="inline-block bg-primary text-white font-bold px-4 py-1.5 rounded-full text-[10px] tracking-widest mb-4 uppercase shadow-lg">Data File</div>
                        <h2 className="text-3xl md:text-4xl font-black font-serif text-primary mb-6 tracking-tight">『故郷』徹底解剖データファイル</h2>
                        <div className="bg-white px-6 py-4 rounded-2xl shadow-apple max-w-3xl mx-auto text-left border border-slate-100">
                            <p className="font-bold text-primary text-center text-base leading-relaxed">
                                テーマ：二人の心を隔てた『厚い壁』の正体は、<br/>
                                <span className="text-emerald-600 bg-emerald-50 px-2 py-1 rounded mx-1">「経済格差（カネ）」</span>か、
                                <span className="text-rose-600 bg-rose-50 px-2 py-1 rounded mx-1">「精神的格差（心）」</span>か。
                            </p>
                        </div>
                    </section>

                    {/* Winning Logic Method */}
                    <section id="method" className="relative bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl p-6 md:p-10 shadow-floating text-white overflow-hidden">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-amber-500/20 rounded-full blur-3xl transform translate-x-1/3 -translate-y-1/3"></div>
                        <div className="absolute bottom-0 left-0 w-64 h-64 bg-indigo-500/20 rounded-full blur-3xl transform -translate-x-1/3 translate-y-1/3"></div>
                        
                        <div className="relative z-10">
                            <div className="flex items-center gap-3 mb-8 justify-center">
                                <DynamicIcon name="lightbulb" className="text-amber-400" size={24} />
                                <h2 className="text-xl md:text-2xl font-bold font-serif text-white tracking-wide">最強の「論拠」の方程式</h2>
                            </div>
                            
                            <div className="flex flex-col md:flex-row items-stretch justify-center gap-3 mb-8 text-center">
                                <div className="flex-1 bg-white/10 backdrop-blur-md border border-white/10 p-4 rounded-2xl flex flex-col items-center justify-center min-h-[120px]">
                                    <h3 className="font-bold text-white mb-1">教科書本文</h3>
                                    <p className="text-[10px] text-slate-300">記述・セリフ</p>
                                    <p className="text-indigo-300 font-bold text-xs mt-2">事実 (Fact)</p>
                                </div>
                                <div className="flex items-center justify-center text-slate-500 font-black text-xl rotate-90 md:rotate-0"><DynamicIcon name="x" size={20}/></div>
                                <div className="flex-1 bg-white/10 backdrop-blur-md border border-white/10 p-4 rounded-2xl flex flex-col items-center justify-center min-h-[120px]">
                                    <h3 className="font-bold text-white mb-1">探究資料 A~H</h3>
                                    <p className="text-[10px] text-slate-300">歴史・数字・背景</p>
                                    <p className="text-emerald-300 font-bold text-xs mt-2">根拠 (Evidence)</p>
                                </div>
                                <div className="flex items-center justify-center text-amber-500 font-black text-xl rotate-90 md:rotate-0">=</div>
                                <div className="flex-1 bg-amber-500 text-slate-900 p-4 rounded-2xl shadow-lg flex flex-col items-center justify-center min-h-[120px] transform md:scale-105">
                                    <h3 className="font-black mb-1 text-lg">最強の論拠</h3>
                                    <p className="text-[10px] text-slate-800 font-bold">反論できない意見</p>
                                    <p className="text-slate-900/70 font-bold text-xs mt-2">説得力 ∞</p>
                                </div>
                            </div>

                            <div className="bg-white/5 rounded-2xl p-6 border border-white/10">
                                <h4 className="font-bold text-xs text-slate-400 mb-4 text-center tracking-widest uppercase">組み合わせ例</h4>
                                <div className="grid md:grid-cols-2 gap-4 text-sm">
                                    <div className="bg-emerald-900/30 p-4 rounded-xl border border-emerald-500/30">
                                        <span className="bg-emerald-500 text-white text-[10px] font-bold px-2 py-0.5 rounded mb-2 inline-block">カネ派の作戦</span>
                                        <p className="text-emerald-100 mb-2 text-xs opacity-80 leading-relaxed">教科書「売りに行けば税金を取られる」<br/>＋ 資料B「通行税・30年分の前借り」</p>
                                        <p className="text-emerald-400 font-bold text-sm border-t border-emerald-500/30 pt-2">＝ 努力不足ではない。システムによる搾取だ。</p>
                                    </div>
                                    <div className="bg-rose-900/30 p-4 rounded-xl border border-rose-500/30">
                                        <span className="bg-rose-500 text-white text-[10px] font-bold px-2 py-0.5 rounded mb-2 inline-block">心派の作戦</span>
                                        <p className="text-rose-100 mb-2 text-xs opacity-80 leading-relaxed">教科書「旦那様！」<br/>＋ 資料F「権威への依存・身分制度による安心」</p>
                                        <p className="text-rose-400 font-bold text-sm border-t border-rose-500/30 pt-2">＝ カネではない。自ら身分制度にすがった心の壁だ。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Reference Cards */}
                    <div className="grid gap-10">
                        <section id="history" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6 border-b border-slate-50 pb-4">
                                <div className="w-12 h-12 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center shadow-sm"><DynamicIcon name="clock" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-indigo-800">資料A：【歴史】激動の30年史</h2>
                                    <p className="text-sm text-secondary font-bold mt-1">〜「革命」はなぜ民衆を救えなかったのか？〜</p>
                                </div>
                            </div>
                            <div className="relative border-l-2 border-slate-100 ml-6 pl-8 space-y-10">
                                <div className="relative">
                                    <div className="absolute -left-[41px] top-1 w-4 h-4 rounded-full ring-4 ring-white bg-slate-300 shadow-sm"></div>
                                    <span className="bg-slate-100 text-slate-500 font-bold text-[10px] px-2 py-1 rounded mb-2 inline-block">1900年頃（少年時代）：清王朝末期</span>
                                    
                                    <p className="text-secondary text-sm leading-relaxed mt-1">政治は腐敗していたが、伝統的な社会秩序は機能していた。「私」の家は裕福で、身分を超えた少年同士の交流が可能だった。</p>
                                </div>
                                <div className="relative">
                                    <div className="absolute -left-[41px] top-1 w-4 h-4 rounded-full ring-4 ring-white bg-rose-500 shadow-sm"></div>
                                    <span className="bg-rose-100 text-rose-600 font-bold text-[10px] px-2 py-1 rounded mb-2 inline-block">1911年（転換点）：辛亥革命</span>
                                    
                                    <p className="text-secondary text-sm leading-relaxed mt-1">清が滅び、アジア初の共和国「中華民国」が誕生。知識人たちは「これで自由で平等な国になる」と熱狂的に期待した。</p>
                                </div>
                                <div className="relative">
                                    <div className="absolute -left-[41px] top-1 w-4 h-4 rounded-full ring-4 ring-white bg-slate-800 shadow-sm"></div>
                                    <span className="bg-slate-100 text-slate-500 font-bold text-[10px] px-2 py-1 rounded mb-2 inline-block">1921年（現在）：軍閥割拠（ぐんばつかっきょ）</span>
                                    
                                    <p className="text-secondary text-sm leading-relaxed mt-1">統一政府が崩壊し、地方の軍閥（ボス）による内戦が勃発。治安は革命前よりも悪化し、農村は略奪の対象となった。「私」の家も没落し、故郷を去ることになる。</p>
                                </div>
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                    <span className="font-bold text-primary text-sm block mb-1">【考察】</span>
                                    <span className="text-secondary text-sm">革命で良くなるはずだった社会が逆に悪化したという「絶望感」が背景にある。</span>
                                </div>
                            </div>
                        </section>

                        <section id="taxes" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6 border-b border-slate-50 pb-4">
                                <div className="w-12 h-12 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center shadow-sm"><DynamicIcon name="file-text" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-emerald-800">資料B：【重税】軍閥からの過酷な税金の徴収</h2>
                                    <p className="text-sm text-secondary font-bold mt-1">〜30年先の未来まで奪うシステム〜</p>
                                </div>
                            </div>
                            <div className="space-y-6">
                                <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                    <h3 className="font-bold text-primary mb-3">① 税金の「前借り」徴収</h3>
                                    <p className="text-sm text-secondary leading-relaxed mb-4">軍閥は戦費調達のため、未来の税金まで現在徴収した。四川省などでは<strong className="text-rose-600">「21世紀半ば（2050年頃）」</strong>までの税金が既に徴収済みであった。</p>
                                    <p className="text-sm font-bold text-primary">結論：孫の代までの稼ぎが、今すべて奪われている状態。</p>
                                    <div className="w-full h-6 bg-slate-200 rounded-full flex overflow-hidden mt-3">
                                        <div className="w-[10%] bg-emerald-500 text-[8px] flex items-center justify-center text-white font-bold">1921</div>
                                        <div className="w-[90%] bg-[repeating-linear-gradient(45deg,#ef4444,#ef4444_10px,#dc2626_10px,#dc2626_20px)] flex items-center justify-center text-[8px] text-white font-bold tracking-widest opacity-80">孫の代まで没収</div>
                                    </div>
                                </div>
                                <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                    <h3 className="font-bold text-primary mb-3">② 逃げ場のない雑税</h3>
                                    <p className="text-sm text-secondary leading-relaxed mb-3">閏土の言う「売りに行けば税金を取られる」とは「通行税（釐金）」のこと。<br/>その他：土地税、家畜税、アヘン税、塩税、靴税、門税など数十種類。</p>
                                    <p className="text-xs font-bold text-rose-600 bg-rose-50 inline-block px-2 py-1 rounded">これに加え、軍隊による直接的な「略奪」も日常茶飯事だった。</p>
                                </div>
                            </div>
                        </section>

                        <section id="currency" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6 border-b border-slate-50 pb-4">
                                <div className="w-12 h-12 bg-amber-50 text-amber-600 rounded-2xl flex items-center justify-center shadow-sm"><DynamicIcon name="coins" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-amber-800">資料C：【通貨】貨幣経済の罠</h2>
                                    <p className="text-sm text-secondary font-bold mt-1">〜働けば働くほど貧しくなる交換レート〜</p>
                                </div>
                            </div>
                            <div className="grid md:grid-cols-2 gap-6 items-center">
                                <div className="space-y-3">
                                    <div className="bg-amber-50 p-4 rounded-2xl border border-amber-100">
                                        <div className="flex justify-between mb-1 font-bold text-amber-800 text-sm"><span>農民の収入 (銅貨)</span><DynamicIcon name="trending-down" size={16} className="text-rose-500"/></div>
                                        <p className="text-xs text-slate-600">軍閥が粗悪な銅貨を乱発したため、価値が大暴落（インフレ）。</p>
                                    </div>
                                    <div className="bg-indigo-50 p-4 rounded-2xl border border-indigo-100">
                                        <div className="flex justify-between mb-1 font-bold text-indigo-800 text-sm"><span>税金の支払 (銀貨)</span><DynamicIcon name="trending-up" size={16} className="text-blue-500"/></div>
                                        <p className="text-xs text-slate-600">納税には価値の安定した銀貨が必要。価値が高騰。</p>
                                    </div>
                                </div>
                                <div className="bg-slate-50 p-6 rounded-2xl text-center border border-slate-100">
                                    <h3 className="text-xs font-bold text-slate-400 mb-4">銀貨1枚を買うのに必要な銅貨</h3>
                                    <div className="flex items-end justify-center gap-4 h-24 mb-4">
                                        <div className="w-12 bg-slate-300 rounded-t-lg h-[60%] flex items-center justify-center text-white font-bold text-sm">100</div>
                                        <DynamicIcon name="arrow-right" className="mb-6 text-slate-300"/>
                                        <div className="w-12 bg-rose-500 rounded-t-lg h-[90%] flex items-center justify-center text-white font-bold text-sm animate-pulse">140</div>
                                    </div>
                                    <p className="text-xs font-bold text-rose-600">結論：何も買わなくても、レートの変動だけで借金が自動的に1.4倍に増える仕組み。</p>
                                </div>
                            </div>
                        </section>

                        <section id="education" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6">
                                <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center"><DynamicIcon name="book-open" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-blue-800">資料D：【教育】「私」と「閏土」の時代・立場による常識の変化</h2>
                                    <p className="text-sm text-secondary font-bold">〜1%のエリート vs 99%の農民〜</p>
                                </div>
                            </div>
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="bg-indigo-50/30 p-5 rounded-2xl border-l-4 border-indigo-500">
                                    <div className="font-bold text-indigo-900 mb-2">「私」の世界</div>
                                    <ul className="text-sm text-slate-700 space-y-2">
                                        <li><span className="font-bold text-indigo-500">属性:</span> 識字率1%未満の超エリート。科挙廃止後の新教育を受け、留学経験あり。</li>
                                        <li><span className="font-bold text-indigo-500">思想:</span> 科学・進化論・民主主義。「神などいない」と考える無神論者。</li>
                                        <li><span className="font-bold text-indigo-500">視点:</span> 閏土の信仰を「迷信」と笑い、彼を「啓蒙すべき対象」と見下す無自覚なエリート意識。</li>
                                    </ul>
                                </div>
                                <div className="bg-amber-50/30 p-5 rounded-2xl border-l-4 border-amber-600">
                                    <div className="font-bold text-amber-900 mb-2">閏土の世界</div>
                                    <ul className="text-sm text-slate-700 space-y-2">
                                        <li><span className="font-bold text-amber-600">属性:</span> 非識字（文字が読めない）。情報は村の噂や言い伝えのみ。</li>
                                        <li><span className="font-bold text-amber-600">思想:</span> 伝統・運命論・多神教。</li>
                                        <li><span className="font-bold text-amber-600">視点:</span> 苦難は「運命」であり、救いは「香炉（神頼み）」にしかないと信じる。</li>
                                    </ul>
                                </div>
                            </div>
                        </section>

                        <section id="survival" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6">
                                <div className="w-12 h-12 bg-rose-50 text-rose-600 rounded-2xl flex items-center justify-center"><DynamicIcon name="skull" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-rose-800">資料E：【生存】極限の生存環境</h2>
                                    <p className="text-sm text-secondary font-bold">〜生きるか死ぬかの限界状態〜</p>
                                </div>
                            </div>
                            <div className="space-y-4">
                                <div className="bg-slate-50 p-5 rounded-2xl">
                                    <h3 className="font-bold text-primary mb-2">1920年 華北五省大飢饉</h3>
                                    <p className="text-sm text-secondary leading-relaxed">物語執筆の前年に発生した未曾有の大干ばつ。<br/>被災者2,000万人、死者50万人。「子供を売る」「木の皮を食べる」地獄のような状況。</p>
                                </div>
                                <div className="bg-rose-50 text-rose-900 p-5 rounded-2xl border border-rose-100">
                                    <h3 className="font-bold mb-1 flex items-center gap-2 text-sm"><DynamicIcon name="users" size={16}/> なぜ「多産」なのか？</h3>
                                    <p className="text-xs leading-relaxed">当時の平均寿命は30〜40歳。乳幼児死亡率が極めて高い。「貧乏人の子だくさん」ではない。多く産まなければ全滅して家が絶えてしまうため、「多産」は生存のための悲しい戦略だった。</p>
                                </div>
                            </div>
                        </section>

                        <section id="psychology" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6">
                                <div className="w-12 h-12 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center"><DynamicIcon name="brain" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-purple-800">資料F：【心理】なぜ「木偶の坊」になったのか</h2>
                                    <p className="text-sm text-secondary font-bold">〜心理学的アプローチ〜</p>
                                </div>
                            </div>
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="p-5 rounded-2xl border border-slate-100">
                                    <h3 className="font-bold text-primary text-sm mb-2 flex items-center gap-2"><DynamicIcon name="zap-off" size={16} className="text-purple-500"/> 学習性無力感</h3>
                                    <p className="text-xs text-secondary leading-relaxed">長期間、回避不能なストレス（重税・飢餓）にさらされると、人は「何をしても無駄だ」と学習する。抵抗する気力を失い無反応になる。沈黙は「愚かさ」ではなく「心の麻痺（防衛反応）」。</p>
                                </div>
                                <div className="p-5 rounded-2xl border border-slate-100">
                                    <h3 className="font-bold text-primary text-sm mb-2 flex items-center gap-2"><DynamicIcon name="shield" size={16} className="text-purple-500"/> 伝統的権威への依存</h3>
                                    <p className="text-xs text-secondary leading-relaxed">社会が混乱してルールが消失した時、人は唯一わかりやすい「昔ながらのルール」にすがる。閏土にとって「旦那様と使用人」という関係は、唯一安心できる「自分の居場所」だったため、自らそう呼んだ可能性がある。</p>
                                </div>
                            </div>
                        </section>

                        <section id="appearance" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6">
                                <div className="w-12 h-12 bg-slate-100 text-slate-600 rounded-2xl flex items-center justify-center"><DynamicIcon name="scissors" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-slate-800">資料G：【外見】一目でわかる「違い」</h2>
                                    <p className="text-sm text-secondary font-bold">〜辮髪（べんぱつ）が意味するもの〜</p>
                                </div>
                            </div>
                            <div className="flex justify-around bg-slate-50 rounded-2xl p-6 gap-4">
                                <div className="text-center">
                                    <DynamicIcon name="scissors" className="mx-auto mb-2 text-indigo-600" size={24}/>
                                    <div className="font-bold text-indigo-800 text-sm">「私」：髪を切った</div>
                                    <p className="text-[10px] text-secondary mt-1">革命支持と「モダン」の証。<br/>新しい時代の人間。</p>
                                </div>
                                <div className="font-black text-slate-300 flex items-center">VS</div>
                                <div className="text-center">
                                    <DynamicIcon name="lock" className="mx-auto mb-2 text-amber-700" size={24}/>
                                    <div className="font-bold text-amber-800 text-sm">閏土：髪を残した</div>
                                    <p className="text-[10px] text-secondary mt-1">「魂が抜ける」という迷信や、<br/>恐怖から旧習を守る。古い時代の人間。</p>
                                </div>
                            </div>
                            <p className="text-center text-sm text-slate-500 mt-4 font-bold">結論：再会した瞬間、言葉を交わす前に「違う世界の人間だ」と直感するビジュアルの壁があった。</p>
                        </section>

                        <section id="philosophy" className="bg-white rounded-3xl p-8 shadow-apple border border-white">
                            <div className="flex items-center gap-4 mb-6">
                                <div className="w-12 h-12 bg-slate-800 text-white rounded-2xl flex items-center justify-center"><DynamicIcon name="lightbulb" size={24}/></div>
                                <div>
                                    <h2 className="text-xl font-bold font-serif text-slate-900">資料H：【哲学】希望と偶像</h2>
                                    <p className="text-sm text-secondary font-bold">〜ラストシーンの解釈〜</p>
                                </div>
                            </div>
                            <div className="space-y-4">
                                <div className="bg-amber-50 p-5 rounded-2xl border border-amber-100">
                                    <h3 className="font-bold text-amber-800 mb-2 flex items-center gap-2 text-sm"><DynamicIcon name="flame" size={16}/> 偶像</h3>
                                    <p className="text-xs text-slate-700 leading-relaxed">対象：閏土の「香炉・燭台」。<br/>「私」はこれを迷信だと笑ったが、直後に「私の抱く希望も手製の偶像ではないか」と自問する。形は違っても、二人とも「すがるもの」を求めている。</p>
                                </div>
                                <div className="bg-indigo-50 p-5 rounded-2xl border border-indigo-100">
                                    <h3 className="font-bold text-indigo-800 mb-2 flex items-center gap-2 text-sm"><DynamicIcon name="footprints" size={16}/> 地上の道</h3>
                                    <p className="text-xs text-slate-700 leading-relaxed">対象：「私」の「新しい生活（希望）」。<br/>「もともと地上には道はない。歩く人が多くなれば、それが道になるのだ。」<br/>解釈：これは「待てば来る」という予言ではない。「今は道がない」という絶望的な認識を出発点にした、<strong>行動への意志の表明</strong>である。</p>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div className="text-center py-10 opacity-50">
                        <p className="font-serif font-bold text-lg text-slate-300 italic">Facts are here. The logic is yours.</p>
                        <p className="text-slate-400 mt-2 text-[10px] uppercase tracking-widest">2025 中学校国語『故郷』ディベート探究資料</p>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('diagnosis');
            const [answers, setAnswers] = useState({});
            
            // Scroll Persistence State
            const [scrollPositions, setScrollPositions] = useState({ diagnosis: 0, reference: 0 });
            const mainScrollRef = useRef(null);

            // Load answers from LocalStorage on mount
            useEffect(() => {
                const savedAnswers = localStorage.getItem('kokyou-answers');
                if (savedAnswers) {
                    setAnswers(JSON.parse(savedAnswers));
                }
            }, []);

            // Save answers to LocalStorage on change
            useEffect(() => {
                if (Object.keys(answers).length > 0) {
                    localStorage.setItem('kokyou-answers', JSON.stringify(answers));
                }
            }, [answers]);

            const handleAnswer = (qId, type) => {
                setAnswers(prev => ({ ...prev, [qId]: type }));
            };

            const calculateScore = () => {
                let money = 0;
                let heart = 0;
                Object.values(answers).forEach(type => {
                    if (type === 'money') money++;
                    if (type === 'heart') heart++;
                });
                return { money, heart, total: money + heart };
            };

            const scores = calculateScore();

            const switchMode = (newMode) => {
                if (mode === newMode) return;
                
                // Save current scroll position
                if (mainScrollRef.current) {
                    const currentScroll = mainScrollRef.current.scrollTop;
                    setScrollPositions(prev => ({ ...prev, [mode]: currentScroll }));
                }
                
                setMode(newMode);
            };

            // Restore scroll position after mode change
            useLayoutEffect(() => {
                if (mainScrollRef.current) {
                    mainScrollRef.current.scrollTop = scrollPositions[mode] || 0;
                }
            }, [mode]);

            return (
                <div className="flex flex-col h-[100dvh] w-full bg-slate-50 text-slate-800 font-sans overflow-hidden">
                    {/* Header */}
                    <header className="flex-none bg-slate-900 text-white pt-10 pb-6 shadow-lg relative overflow-hidden z-30">
                        <div className="max-w-4xl mx-auto px-4 relative z-10">
                            <div className="flex flex-col justify-center items-start gap-4 mb-2">
                                <div>
                                    <span className="bg-amber-500 text-slate-900 text-xs font-bold px-3 py-1 rounded-full inline-block mb-3 shadow">中3国語『故郷』</span>
                                    <h1 className="text-xl md:text-3xl font-bold tracking-wider font-serif mb-3 leading-relaxed text-slate-100">
                                        論題：心を隔てた『厚い壁』の正体は...<br/>
                                        <span className="block mt-2 text-base md:text-xl font-sans font-normal opacity-90">
                                            ・「経済格差（カネ）」か<br/>
                                            ・「精神的格差（心）」か。
                                        </span>
                                    </h1>
                                    <p className="text-slate-400 text-sm mt-2 max-w-lg">直感的な「診断」と、客観的な「データ」。<br/>二つのアプローチで物語の真実に迫る。</p>
                                </div>
                            </div>
                        </div>
                        {/* Background Decoration */}
                        <div className="absolute top-0 right-0 w-64 h-64 bg-amber-500/10 rounded-full blur-3xl transform translate-x-1/2 -translate-y-1/2"></div>
                        <div className="absolute bottom-0 left-0 w-48 h-48 bg-indigo-500/10 rounded-full blur-3xl transform -translate-x-1/2 translate-y-1/2"></div>
                    </header>

                    {/* Main Content Area */}
                    <main 
                        ref={mainScrollRef}
                        className="flex-1 overflow-y-auto overflow-x-hidden scroll-container relative z-10 bg-slate-50"
                    >
                        <div className="max-w-4xl mx-auto px-4 py-8">
                            {mode === 'diagnosis' ? (
                                <Diagnosis answers={answers} onAnswer={handleAnswer} />
                            ) : (
                                <Reference />
                            )}
                        </div>
                    </main>

                    {/* Fixed Footer Navigation & Meter */}
                    <div className="flex-none z-50 w-full glass-panel border-t border-slate-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] safe-area-pb">
                        
                        {/* Meter Section */}
                        <div className="px-4 pt-3 pb-2 max-w-4xl mx-auto">
                            <div className="flex justify-between text-[10px] font-bold mb-1 uppercase tracking-wider text-slate-400">
                                <span className={scores.money > 0 ? "text-emerald-600" : ""}>カネ派: {scores.money}</span>
                                <span>回答数: {scores.total} / 15</span>
                                <span className={scores.heart > 0 ? "text-rose-600" : ""}>心派: {scores.heart}</span>
                            </div>
                            <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden flex relative mb-2">
                                <div className="absolute left-1/2 top-0 bottom-0 w-[1px] bg-slate-300 z-10 opacity-30"></div>
                                <div className="flex-1 flex justify-end bg-slate-50">
                                    <div 
                                        className="h-full bg-emerald-500 transition-all duration-500 rounded-l-full" 
                                        style={{ width: scores.total === 0 ? '0%' : `${(scores.money / (scores.money + scores.heart || 1)) * 100}%` }}
                                    ></div>
                                </div>
                                <div className="flex-1 flex justify-start bg-slate-50">
                                    <div 
                                        className="h-full bg-rose-500 transition-all duration-500 rounded-r-full" 
                                        style={{ width: scores.total === 0 ? '0%' : `${(scores.heart / (scores.money + scores.heart || 1)) * 100}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>

                        {/* Navigation Buttons */}
                        <div className="grid grid-cols-2 gap-2 px-2 pb-2 max-w-4xl mx-auto">
                            <button 
                                onClick={() => switchMode('diagnosis')}
                                className={`flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${
                                    mode === 'diagnosis' 
                                    ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/20 translate-y-[-2px]' 
                                    : 'bg-transparent text-slate-400 hover:bg-slate-50 hover:text-slate-600'
                                }`}
                            >
                                <div className="flex items-center gap-2">
                                    <DynamicIcon name="check-circle" size={18} className={mode === 'diagnosis' ? "text-amber-400" : "opacity-50"}/>
                                    <span className="font-bold text-sm">STEP 1: 診断</span>
                                </div>
                            </button>
                            
                            <button 
                                onClick={() => switchMode('reference')}
                                className={`flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${
                                    mode === 'reference' 
                                    ? 'bg-slate-900 text-white shadow-lg shadow-slate-900/20 translate-y-[-2px]' 
                                    : 'bg-transparent text-slate-400 hover:bg-slate-50 hover:text-slate-600'
                                }`}
                            >
                                <div className="flex items-center gap-2">
                                    <DynamicIcon name="book-open" size={18} className={mode === 'reference' ? "text-amber-400" : "opacity-50"}/>
                                    <span className="font-bold text-sm">STEP 2: 資料</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
